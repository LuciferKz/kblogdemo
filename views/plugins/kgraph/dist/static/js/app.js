!function(n){var o={};function i(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=n,i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=function(t){var e=o(t);return null!==t&&"object"===e||"function"===e},i=function(t,e){return{}.toString.call(t)==="[object ".concat(e,"]")},u=function(t){return i(t,"Array")},a=function(t,e){if(t)if(u(t))for(var n=0,o=t.length;n<o&&!1!==e(t[n],n);n++);else if(r(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break};function s(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(){var t=Array.from(arguments),e=t.shift();return Object.assign?Object.assign.apply(Object,[e].concat(s(t))):R.each(t,function(t){!function(t,e){for(var n in e)t[n]=e[n]}(e,t)}),e};function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var f=function t(e){if("object"!==l(e)||null===e)return e;var n;if(u(e)){n=[];for(var o=0,i=e.length;o<i;o++)"object"===l(e[o])&&null!=e[o]?n[o]=t(e[o]):n[o]=e[o]}else for(var r in n={},e)"object"===l(e[r])&&null!=e[r]?n[r]=t(e[r]):n[r]=e[r];return n},h=n(3),p=n.n(h);function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var g=function(t){return"object"===y(t)&&null!==t},d=function(t){if(!g(t)||!i(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},v=function t(e,n,o,i){for(var r in o=o||0,i=i||5,n)if(n.hasOwnProperty(r)){var a=n[r];null!==a&&d(a)?(d(e[r])||(e[r]={}),o<i?t(e[r],a,o+1,i):e[r]=n[r]):u(a)?(e[r]=[],e[r]=e[r].concat(a)):void 0!==a&&(e[r]=a)}},m=function(){for(var t=new Array(arguments.length),e=t.length,n=0;n<e;n++)t[n]=arguments[n];for(var o=t[0],i=1;i<e;i++)v(o,t[i]);return o},b=function(t){return i(t,"Function")},x=Object.keys?function(t){return Object.keys(t)}:function(n){var o=[];return a(n,function(t,e){b(n)&&"prototype"===e||o.push(e)}),o},w=function(t){return null==t};var _=function(t,e){var n=x(e),o=n.length;if(w(t))return!o;for(var i=0;i<o;i+=1){var r=n[i];if(e[r]!==t[r]||!(r in t))return!1}return!0};var k=function(t,e){var n;if(b(e)&&(n=e),d(e)&&(n=function(t){return _(t,e)}),n)for(var o=0;o<t.length;o+=1)if(n(t[o]))return t[o];return null};function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var O="object"===("undefined"==typeof HTMLElement?"undefined":S(HTMLElement))?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"===S(t)&&1===t.nodeType&&"string"==typeof t.nodeName},P=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},j=function(t){return"string"==typeof t},E={}.toString,M=function(t){return E.call(t).replace(/^\[object /,"").replace(/\]$/,"")},C=Object.prototype,I=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||C)},z=Object.prototype.hasOwnProperty;var D=function(t){if(w(t))return!0;if(P(t))return!t.length;var e=M(t);if("Map"===e||"Set"===e)return!t.size;if(I(t))return!Object.keys(t).length;for(var n in t)if(z.call(t,n))return!1;return!0},T={isDom:O,isArray:u,isArrayLike:P,isString:j,isObjectLike:g,isPlainObject:d,isFunction:b,isEmpty:D,isNil:w,isPrototype:I,getType:M},A=function(t,e){return(t%e+e)%e};var B=function(t){return P(t)?Array.prototype.slice.call(t):[]},L=function(t){for(var e=B(arguments),n=1;n<e.length;n++){var o=e[n];b(o)&&(o=o.prototype),p()(t.prototype,o)}},W=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},N={find:k,each:a,extend:c,clone:f,mix:p.a,deepMix:m,mod:A,augment:L,toArray:B,toUpperFirst:W};p()(N,T);var R=e.a=N},function(t,e){var a={};a.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},a.angle=function(t,e){var n,o,i,r=a.dot(t,e)/(a.length(t)*a.length(e));return Math.acos((n=r)<(o=-(i=1))?o:i<n?i:n)},a.direction=function(t,e){return t[0]*e[1]-e[0]*t[1]},a.angleTo=function(t,e,n){var o=a.angle(t,e),i=0<=a.direction(t,e);return n?i?2*Math.PI-o:o:i?o:2*Math.PI-o},a.vertical=function(t,e,n){return t[1]=n?(t[0]=e[1],-1*e[0]):(t[0]=-1*e[1],e[0]),t},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},a.normalize=function(t,e){var n=e[0],o=e[1],i=n*n+o*o;return 0<i&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},a.squaredDistance=function(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o},a.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},a.distance=function(t,e){var n=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(n*n+o*o)},t.exports=a},function(t,e,n){"use strict";var r=n(0);function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var a=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._cfg=r.a.mix(this.getDefaultCfg(),t),this.set("style",this.getShapeStyle())}var t,n,o;return t=e,(n=[{key:"draw",value:function(){}},{key:"set",value:function(t,e){r.a.isPlainObject(t)?this._cfg=r.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}},{key:"updatePosition",value:function(t,e){this._cfg.x=t,this._cfg.y=e}},{key:"update",value:function(t){this._cfg=r.a.deepMix(this._cfg,t),this.set("style",this.getShapeStyle())}},{key:"getDefaultCfg",value:function(){return{x:0,y:0,size:10}}}])&&i(t.prototype,n),o&&i(t,o),e}();function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function s(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function m(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function k(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function E(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function D(t,e){return!e||"object"!==I(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var B={rect:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,c(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,a),n=e,(o=[{key:"draw",value:function(t){this._draw(t)}},{key:"_draw",value:function(t){var e=this.get("style");e.lineDash&&t.setLineDash(e.lineDash),e.fill&&(t.fillStyle=e.fill,t.fillRect(e.x,e.y,e.width,e.height)),e.stroke&&(t.lineWidth=e.lineWidth,t.strokeStyle=e.stroke,t.strokeRect(e.x,e.y,e.width,e.height))}},{key:"_updatePosition",value:function(t,e){this._cfg.style.x=t,this._cfg.style.y=e}},{key:"_updateSize",value:function(t,e){this._cfg.style.width=t,this._cfg.style.height=e}},{key:"getDefaultCfg",value:function(){return{x:0,y:0}}},{key:"getShapeStyle",value:function(){var t=this._cfg,e=t.size;r.a.isArray(t.size)?this._updateSize(e[0],e[1]):this._updateSize(e,e),this._updatePosition(t.x-t.style.width/2,t.y-t.style.height/2);var n={};return r.a.extend(n,this.getDefaultStyle(),t.style),n}},{key:"getDefaultStyle",value:function(){return{z:0,width:0,height:0,color:"#000",stroke:!1,lineWidth:1,lineDash:null}}}])&&u(n.prototype,o),i&&u(n,i),e}(),line:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,y(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(e,a),n=e,(o=[{key:"draw",value:function(t){this._draw(t)}},{key:"_draw",value:function(n){if(!n)throw new Error("illegal context");var t=this.get("style"),e=this.get("points");n.save(),t.lineDash&&n.setLineDash(t.lineDash),n.strokeStyle=t.stroke,n.lineWidth=t.lineWidth,n.lineJoin=t.lineJoin,n.lineCap=t.lineCap,n.beginPath(),r.a.each(e,function(t,e){0===e?n.moveTo(t.x,t.y):n.lineTo(t.x,t.y)}),n.stroke(),n.restore()}},{key:"updatePoints",value:function(t){this.set("points",t)}},{key:"getDefaultStyle",value:function(){return{stroke:"#000",lineWidth:2,lineJoin:"miter",lineCap:"butt"}}},{key:"getShapeStyle",value:function(){return r.a.mix({},this.getDefaultStyle(),this._cfg.style)}},{key:"getDefaultCfg",value:function(){return{points:[]}}}])&&h(n.prototype,o),i&&h(n,i),e}(),polyline:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,b(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(e,a),n=e,(o=[{key:"draw",value:function(t){this._draw(t)}},{key:"_draw",value:function(n){if(!n)throw new Error("illegal context");var t=this.get("style"),e=this.get("points");n.strokeStyle=t.stroke,n.lineWidth=t.lineWidth,n.lineJoin=t.lineJoin,n.lineCap=t.lineCap,n.beginPath(),r.a.each(e,function(t,e){0===e?n.moveTo(t.x,t.y):n.lineTo(t.x,t.y)}),n.stroke()}},{key:"updatePoints",value:function(t){this.set("points",t)}},{key:"getDefaultStyle",value:function(){return{stroke:"#000",lineWidth:2,lineJoin:"miter",lineCap:"butt"}}},{key:"getShapeStyle",value:function(){return r.a.mix({},this.getDefaultStyle(),this._cfg.style)}},{key:"getPoints",value:function(){this.get("points"),this.get("anchors")}},{key:"getDefaultCfg",value:function(){return{points:[],anchors:[]}}}])&&v(n.prototype,o),i&&v(n,i),e}(),circle:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),k(this,S(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(e,a),n=e,(o=[{key:"draw",value:function(t){this._draw(t)}},{key:"_draw",value:function(t){if(!t)throw new Error("illegal context");var e=this.get("style");t.save(),t.lineWidth=e.lineWidth,t.strokeStyle=e.stroke,t.fillStyle=e.fill,t.beginPath(),t.arc(e.x,e.y,e.r,0,2*Math.PI),e.fill&&t.fill(),e.stroke&&t.stroke(),t.restore()}},{key:"changePosition",value:function(t,e){this._cfg.style.x=t,this._cfg.style.y=e}},{key:"changeSize",value:function(t){this._cfg.style.r=t}},{key:"getShapeStyle",value:function(){var t=this._cfg,e=t.size;r.a.isArray(t.size)?this.changeSize(e[0],e[1]):this.changeSize(e,e),this.changePosition(t.x,t.y);var n={};return r.a.extend(n,this.getDefaultStyle(),t.style),n}},{key:"getDefaultStyle",value:function(){return{z:0,width:0,height:0,color:"#000",stroke:!1,lineWidth:1}}},{key:"getDefaultCfg",value:function(){return{x:0,y:0}}}])&&_(n.prototype,o),i&&_(n,i),e}(),text:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),E(this,M(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(e,a),n=e,(o=[{key:"draw",value:function(t){this._draw(t,this._cfg)}},{key:"_draw",value:function(t,e){if(!t)throw new Error("illegal context");var n=this.get("style");t.save(),t.textBaseline=n.baseline,t.fillStyle=n.color,t.textAlign=n.align,t.font=n.weight+" "+n.size+" "+n.family,t.shadowBlur=n.shadowBlur,t.shadowColor=n.shadowColor,t.shadowOffsetX=n.shadowOffsetX,t.shadowOffsetY=n.shadowOffsetY,n.stroke?t.strokeText(e.content,e.x,e.y):t.fillText(e.content,e.x,e.y),t.restore()}},{key:"getDefaultCfg",value:function(){return{x:0,y:0,content:""}}},{key:"getShapeStyle",value:function(){var t=r.a.mix({},this.getDefaultStyle(),this.get("style"));return this._cfg.size&&(t.size=this._cfg.size+"px"),t}},{key:"getDefaultStyle",value:function(){return{baseline:"middle",color:"#000",size:"11px",weight:"normal",family:"黑体",align:"center",shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,stroke:!1}}}])&&j(n.prototype,o),i&&j(n,i),e}(),diamond:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),D(this,T(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(e,a),n=e,(o=[{key:"draw",value:function(t){this._draw(t)}},{key:"_draw",value:function(t){if(!t)throw new Error("illegal context");var e=this.get("style");t.fillStyle=e.fill,t.lineWidth=e.lineWidth,t.strokeStyle=e.stroke,t.save(),t.beginPath(),t.moveTo(e.x-e.width/2,e.y),t.lineTo(e.x,e.y-e.height/2),t.lineTo(e.x+e.width/2,e.y),t.lineTo(e.x,e.y+e.height/2),t.closePath(),t.restore(),e.fill&&t.fill(),e.stroke&&t.stroke()}},{key:"changePosition",value:function(t,e){this._cfg.style.x=t,this._cfg.style.y=e}},{key:"changeSize",value:function(t,e){this._cfg.style.width=t,this._cfg.style.height=e}},{key:"getShapeStyle",value:function(){var t=this._cfg,e=t.size;r.a.isArray(t.size)?this.changeSize(e[0],e[1]):this.changeSize(e,e),this.changePosition(t.x,t.y);var n={};return r.a.extend(n,this.getDefaultStyle(),t.style),n}},{key:"getDefaultStyle",value:function(){return{z:0,width:0,height:0,color:"#000",stroke:!1,lineWidth:1}}},{key:"getDefaultCfg",value:function(){return{x:0,y:0}}}])&&z(n.prototype,o),i&&z(n,i),e}()},L=function(t){var e=B[t.type];if(!e)throw new Error("shape ".concat(t.type," is not exsit"));return new e(t)};function W(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var N=function(){function n(t){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.children=[],this._cfg={},t&&t.type){var e=L(t);this._cfg.shape=e,t.layer&&t.layer.addLayer(this)}}var t,e,o;return t=n,(e=[{key:"_init",value:function(){}},{key:"draw",value:function(t){t.save(),this._drawLayer(t),this._draw(t),t.restore()}},{key:"_drawLayer",value:function(t){var e=this.get("shape");e&&e.draw(t)}},{key:"_draw",value:function(e){r.a.each(this.children,function(t){!t.get("hidden")&&t.draw(e)})}},{key:"add",value:function(t){this.children.push(t)}},{key:"addChild",value:function(){}},{key:"removeChild",value:function(){}},{key:"addLayer",value:function(t){return(t.parent=this).add(t),t}},{key:"addShape",value:function(t){var e=L(t);return(e.parent=this).add(e),e}},{key:"set",value:function(t,e){r.a.isPlainObject(t)?this._cfg=r.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}}])&&W(t.prototype,e),o&&W(t,o),n}();e.a=N},function(t,e){function i(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}t.exports=function(t,e,n,o){return e&&i(t,e),n&&i(t,n),o&&i(t,o),t}},function(t,e,n){"use strict";n.r(e);var b=n(0);function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var r=["click","mousedown","mouseup","dblclick","contextmenu","mouseenter","mouseout","mouseover","mousemove","mouseleave","dragstart","dragend","drag","dragenter","dragleave","drop"],a=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.graph=t,this._initEvents()}var t,n,o;return t=e,(n=[{key:"_initEvents",value:function(){var e=this,n=this.graph.get("canvas");b.a.each(r,function(t){n.on(t,e._canvasEvent())})}},{key:"_canvasEvent",value:function(){var e=this;return function(t){e._handleEvents({type:t.type,clientX:t.clientX,clientY:t.clientY,origin:t})}}},{key:"_handleEvents",value:function(i){var t=i.type,e=this.graph,n=e.get("nodes"),o=e.get("edges"),r=(e.get("eventItemMap"),e.get("activeEdge")),a=e.get("targetMap").drag,u=e.getPointByClient(i.clientX,i.clientY);i.clientX=u.x,i.clientY=u.y;var s=[];b.a.each(n.concat(o),function(t){var e=t.get("children"),n=e?b.a.find(e,function(t){return t.isPointIn(u)}):null,o=!1;if(n?(o=!0,t=n):o=t.isPointIn(u),o&&r!==t&&a!==t)return i.target=t,s.push(t),!1}),"mousemove"===t?this._handleEventMousemove(i,s):"mousedown"===t?this._handleEventMousedown(i,s):"mouseup"===t&&this._handleEventMouseup(i,s)}},{key:"_handleEventMousedown",value:function(t,e){var n=this.graph,o=n.get("targetMap"),i=e[0],r=o.focus;console.log("focusItem",r,i),r&&r!=i&&(r.setState("focus",!1),o.focus=null),i&&((o.mousedown=i).setState("focus",!0),(o.focus=i).setState("active",!0),n.set("downPoint",{x:t.clientX,y:t.clientY}),i.emit("mousedown",t)),n.emit("mousedown",t)}},{key:"_handleEventMouseup",value:function(t,e){var n=this.graph.get("targetMap"),o=e[0],i=!1;n.mousedown&&(n.mousedown.setState("active",!1),n.mousedown=null),n.drag&&(i=!0,n.drag.emit("drop",t),n.drag.setState("active",!1),n.drag=null),o&&!i&&o.emit("mouseup",t)}},{key:"_handleEventMousemove",value:function(t,e){var n=this.graph,o=n.get("targetMap"),i=e[0],r=!1,a=o.mousedown,u=o.mouseenter,s=o.dragenter,c=o.drag;if(a&&!c){var l=n.get("downPoint");this._isDragStart([l,{x:t.clientX,y:t.clientY}])&&(a.setState("active",!0),(o.drag=a).emit("dragstart",t))}else c?(r=!0,c.emit("drag",t)):u&&(!u.isPointIn({x:t.clientX,y:t.clientY})||i&&u!==i)&&(o.mouseenter=null,u.setState("hover",!1),u.emit("mouseleave",t),u=null);s&&!s.isPointIn({x:t.clientX,y:t.clientY})&&(o.dragenter=null,s.setState("hover",!1),s.emit("dragleave",t)),i&&(r?(s||c===i||n.get("activeEdge")===i||((o.dragenter=i).setState("hover",!0),i.emit("dragenter",t)),i.emit("mousemove",t)):o.mouseenter!==i&&(u&&(u.setState("active",!1),u.emit("mouseleave",t)),i.setState("hover",!0),(o.mouseenter=i).emit("mouseenter",t)))}},{key:"_isDragStart",value:function(t){return 5<Math.abs(t[0].x-t[1].x)||5<Math.abs(t[0].y-t[1].y)}},{key:"getDefaultOption",value:function(){return{cancelBubble:!0}}}])&&i(t.prototype,n),o&&i(t,o),e}(),u=Array.prototype.slice;var o=function(){};b.a.augment(o,{on:function(t,e,n){var o=this;if(!b.a.isFunction(e))throw new TypeError("listener should be a function");return o._cfg._events||(o._cfg._events={}),o._cfg._events[t]||(o._cfg._events[t]=[]),o._cfg._events[t].push({callback:e,one:n}),this},one:function(t,e){return this.on(t,e,!0),this},emit:function(t){if(!this.get("destroyed")&&this._cfg._events&&!b.a.isEmpty(this._cfg._events)){var e=this._cfg._events[t];if(!b.a.isEmpty(e))for(var n=arguments,o=u.call(n,1),i=e.length,r=0;r<i;)e[r]&&(e[r].callback.apply(this,o),e[r]&&e[r].one?(e.splice(r,1),i--):r++)}},trigger:function(){this.emit.apply(this,arguments)},off:function(t,e){var n=this._cfg._events;if(n&&!b.a.isEmpty(n)){if(0===arguments.length)return this._cfg._events={},this;if(n[t]){var o=function(t,e){for(var n=t.length;n--;)if(t[n].callback===e)return n;return-1}(n[t],e);0<=o&&n[t].splice(o,1),0===n[t].length&&delete n[t]}}},removeEvent:function(t){return void 0===t?this._cfg._events={}:delete this._cfg._events[t],this},_getEvents:function(){return this._cfg._events||{}}});var s=o,c=n(2);function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function h(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var g=function(t){function n(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);return(e=h(this,p(n).call(this)))._cfg=b.a.deepMix({width:1e3,height:500,ratio:1,matrix:[1,0,0,0,1,0,0,0,1]},t),e.init(),e}var e,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(n,c["a"]),e=n,(o=[{key:"init",value:function(){this._init()}},{key:"_init",value:function(){var t=this._cfg,e=this.get("ratio");if(!b.a.isString(t.containerId))throw new Error("containerId must be string");var n=document.getElementById(t.containerId);if(!n)return console.error("canvas is not exsit, please check the containerId"),!1;var o=n.getContext("2d");this.set("canvas",n),this.set("context",o),this.changeSize(t.width,t.height);var i=this.get("width")*e,r=this.get("height")*e;this.addLayer(new c.a({type:"rect",x:i/2,y:r/2,size:[i,r],style:{fill:"#EEE"}}))}},{key:"changeSize",value:function(t,e){this._cfg.width=t,this._cfg.height=e,this._changeSize(t,e)}},{key:"_changeSize",value:function(t,e){var n=this.get("canvas"),o=this.get("ratio");n.width=this._cfg.width*o,n.height=this._cfg.height*o,n.style.width=this._cfg.width+"px",n.style.height=this._cfg.height+"px"}},{key:"draw",value:function(){var t=this.get("context");if(!t)throw new Error("context is not available");this.clean(this.get("width"),this.get("height"));var e=this.get("ratio");t.save(),t.scale(e,e),this._draw(t),t.restore()}},{key:"clean",value:function(t,e){this.get("context").clearRect(0,0,t,e)}},{key:"clear",value:function(){this.children=[],this.clean()}},{key:"destory",value:function(){this.clear()}},{key:"scale",value:function(t){var e=this.get("matrix");e[0]=t,e[4]=t,this.set("ratio",t)}},{key:"getBox",value:function(){var t=this.get("canvas").getBoundingClientRect();return{l:t.left,t:t.top,r:t.right,b:t.bottom,width:t.width,height:t.height}}},{key:"getMatrix",value:function(){return this.get("matrix")}},{key:"on",value:function(t,e){this.get("canvas").addEventListener(t,e)}}])&&f(e.prototype,o),i&&f(e,i),n}();function d(){for(var t=[],e="0123456789abcdef",n=0;n<16;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);return t[3]="4",t[7]=e.substr(3&t[7]|8,1),t.join("")}var v={rect:function(t,e){var n=t.size,o=0,i=0,r=t.x,a=t.y;i=b.a.isArray(n)?(o=n[0],n[1]):o=n;var u=o/2,s=i/2;return{x:r,y:a,t:a-s,l:r-u,b:a+s,r:r+u,width:o,height:i}},circle:function(t){var e=t.size,n=2*e,o=2*e,i=t.x,r=t.y,a=n/2,u=o/2;return{x:i,y:r,t:r-u,l:i-a,b:r+u,r:i+a,width:n,height:o}},diamond:function(t){return this.rect(t)}},m=function(t){return t.type||console.error("shape.type属性不存在"),v[t.type]?v[t.type](t.outlineCfg||t):(console.error("没有找到对应的图形"),{})},x=n(1),k=n.n(x),w={box:function(t,e,n,o,i){var r=i/2,a=Math.min(t,n),u=Math.max(t,n);return{minX:a-r,minY:Math.min(e,o)-r,maxX:u+r,maxY:Math.max(e,o)+r}},pointDistance:function(t,e,n,o,i,r){var a=[n-t,o-e];if(k.a.exactEquals(a,[0,0]))return NaN;var u=[-a[1],a[0]];k.a.normalize(u,u);var s=[i-t,r-e];return Math.abs(k.a.dot(s,u))}},_=function(t,e,n,o){var i=1-o;return i*(i*t+2*o*e)+o*o*n},S=function(t,e,n,o,i,r,a,u,s){var c,l,f,h,p,y,g,d=.005,v=1/0,m=[a,u];for(p=0;p<1;p+=.05)f=[_(t,n,i,p),_(e,o,r,p)],(l=k.a.squaredDistance(m,f))<v&&(c=p,v=l);for(v=1/0,g=0;g<32&&!(d<1e-4);g++){var b=c-d,x=c+d;f=[_(t,n,i,b),_(e,o,r,b)],l=k.a.squaredDistance(m,f),0<=b&&l<v?(c=b,v=l):(h=[_(t,n,i,x),_(e,o,r,x)],y=k.a.squaredDistance(m,h),x<=1&&y<v?(c=x,v=y):d*=.5)}return s&&(s.x=_(t,n,i,c),s.y=_(e,o,r,c)),Math.sqrt(v)},O=function(t,e,n,o,i){var r=1-i;return r*r*(r*o+3*i*n)+i*i*(i*t+3*r*e)},P=function(t,e,n,o,i,r,a,u,s,c,l){var f,h,p,y,g,d,v,m,b=.005,x=1/0,w=[s,c];for(h=0;h<1;h+=.05)p=[O(t,n,i,a,h),O(e,o,r,u,h)],(y=k.a.squaredDistance(w,p))<x&&(f=h,x=y);x=1/0;for(var _=0;_<32&&!(b<1e-4);_++)m=f+b,p=[O(t,n,i,a,v=f-b),O(e,o,r,u,v)],y=k.a.squaredDistance(w,p),0<=v&&y<x?(f=v,x=y):(d=[O(t,n,i,a,m),O(e,o,r,u,m)],g=k.a.squaredDistance(w,d),m<=1&&g<x?(f=m,x=g):b*=.5);return l&&(l.x=O(t,n,i,a,f),l.y=O(e,o,r,u,f)),Math.sqrt(x)},j=function(t,e,n,o){var i,r;return o?t<e?(i=e-t,r=2*Math.PI-n+t):n<t&&(i=2*Math.PI-t+e,r=t-n):(i=t-e,r=n-t),r<i?n:e},E=function(t,e,n,o,i,r,a,u,s){var c,l,f,h,p,y=[a,u],g=[t,e],d=k.a.subtract([],y,g),v=k.a.angleTo([1,0],d);c=v,h=r,p=0,(f=i)-(l=o)>=2*Math.PI&&(p=2*Math.PI),l=b.a.mod(l,2*Math.PI),f=b.a.mod(f,2*Math.PI)+p,c=b.a.mod(c,2*Math.PI),v=h?f<=l?f<c&&c<l?c:j(c,f,l,!0):c<l||f<c?c:j(c,l,f):l<=f?l<c&&c<f?c:j(c,l,f,!0):l<c||c<f?c:j(c,f,l);var m=[n*Math.cos(v)+t,n*Math.sin(v)+e];return s&&(s.x=m[0],s.y=m[1]),k.a.distance(m,y)},M={line:function(t,e,n,o,i,r,a){var u=w.box(t,e,n,o,i);if(!this.box(u.minX,u.maxX,u.minY,u.maxY,r,a))return!1;var s=w.pointDistance(t,e,n,o,r,a);return!isNaN(s)&&s<=i/2},polyline:function(t,e,n,o){var i=t.length-1;if(i<1)return!1;for(var r=0;r<i;r++){var a=t[r].x,u=t[r].y,s=t[r+1].x,c=t[r+1].y;if(this.line(a,u,s,c,e,n,o))return!0}return!1},cubicline:function(t,e,n,o,i,r,a,u,s,c,l){return P(t,e,n,o,i,r,a,u,c,l)<=s/2},quadraticline:function(t,e,n,o,i,r,a,u,s){return S(t,e,n,o,i,r,u,s)<=a/2},arcline:function(t,e,n,o,i,r,a,u,s){return E(t,e,n,o,i,r,u,s)<=a/2},rect:function(t,e,n,o,i,r){return t<=i&&i<=t+n&&e<=r&&r<=e+o},circle:function(t,e,n,o,i){return Math.pow(o-t,2)+Math.pow(i-e,2)<=Math.pow(n,2)},box:function(t,e,n,o,i,r){return t<=i&&i<=e&&n<=r&&r<=o}},C={box:function(t,e){var n=t.get("box");return M.box(n.l,n.r,n.t,n.b,e.x,e.y)},rect:function(t,e){var n=t.get("box");return M.rect(n.l,n.t,n.width,n.height,e.x,e.y)},circle:function(t,e){var n=t.get("box");return M.circle(n.x,n.y,n.width/2,e.x,e.y)},polyline:function(t,e){var n=t.get("shape");return M.polyline(n.points,n.style.lineWidth+6,e.x,e.y)}},I=function(t,e){var n=t.get("shape").type;return!!n&&(C[n]||C.box).apply(this,[t,e])};function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var D={linear:function(t,e,n,o){return t*(n/o)+e}},T=function(l){var f=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=t.type||"linear",h=t.duration||1e3,p=D[e],y=this.getShape(),n=function(t){var e=l[t],n=y.get("style"),o=n[t];if(!o&&0!==o)return{v:!1};var i=0,r=h,a=e-o,u=o,s={},c=setInterval(function(){i<r?(u=p(i+=1e3/60,o,a,r),s[t]=u,n[t]=u,f.get("graph").paint()):(clearInterval(c),s[t]=e,f.update(s))},1e3/60)};for(var o in l){var i=n(o);if("object"===z(i))return i.v}};function A(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var B=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t)}var t,n,o;return t=e,(n=[{key:"init",value:function(t){this._cfg=b.a.deepMix(this.getDefaultCfg(),t),this._init()}},{key:"_init",value:function(){var t=this.get("graph"),e=this.get("parent"),n=e?t.get("shapeMap")[e]:t.get("canvas"),o=b.a.clone(this.getShapeCfg()),i=this.get("stateShapeMap");i&&!i.default&&(i.default=o);var r=n.addShape(o);t.get("shapeMap")[this.get("id")]=r,this.getBox()}},{key:"on",value:function(t,e,n){var o=this.get("graph"),i=o.get("eventMap"),r=o.get("eventItemMap"),a={item:this,callback:e,option:n,children:[]};i[t]?i[t].push(a):i[t]=[a];var u=this.get("id");r[u]||(r[u]={}),r[u][t]=a}},{key:"emit",value:function(t){var e=this.get("graph").get("eventItemMap")[this.get("id")];if(!e)return!1;var n=e[t];if(!n)return!1;var o=n.callback,i=[].slice.call(arguments,1);o.apply(this,i)}},{key:"update",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this._cfg.x,n=this._cfg.y,o=this.getShapeCfg();b.a.mix(o,t),this._isOnlyMove(t)?this.updatePosition(o):(e===o.x&&n===o.y||this.updatePosition(o),(t.width||t.height||t.r||t.size)&&this.updateSize(o),this.updateShape(o)),this.get("graph").autoPaint()}},{key:"updatePosition",value:function(t){var e=this.get("graph");this._cfg.x=t.x,this._cfg.y=t.y;var n=e.get("shapeMap")[this.get("id")];(n.get("shape")?n.get("shape"):n).update({x:t.x,y:t.y})}},{key:"updateSize",value:function(t){t.width||t.height?b.a.isArray.shape.size?(t.size[0]=t.width,t.size[1]=t.height):t.width?t.size=t.width:t.height&&(t.size=t.height):t.r&&(t.size=t.r)}},{key:"updateShape",value:function(){var t=this.get("shape");this.getShape().update(t),this.get("graph").autoPaint()}},{key:"animate",value:function(t,e){T.call(this,t,e)}},{key:"getShapeCfg",value:function(){return this._getShapeCfg()}},{key:"_getShapeCfg",value:function(){return this.get("shape")}},{key:"getBox",value:function(){var t=this.get("shape"),e=this.get("graph").get("ratio"),n=m(t,e);return this.set("box",n),n}},{key:"_isOnlyMove",value:function(t){if(!t)return!1;var e=!b.a.isNil(t.x),n=!b.a.isNil(t.y),o=Object.keys(t);return 1===o.length&&(e||n)||2===o.length&&e&&n}},{key:"isPointIn",value:function(t){return I(this,t)}},{key:"set",value:function(t,e){b.a.isPlainObject(t)?this._cfg=b.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"setState",value:function(t,e){var n=this.get("state");n[t]=e,this.emit("stateChange",t,e,n)}},{key:"get",value:function(t){return this._cfg[t]}},{key:"show",value:function(){var t=this.get("graph");this.set("hidden",!1),this.getShape().update({hidden:!1}),t.paint()}},{key:"hide",value:function(){var t=this.get("graph");this.set("hidden",!0),this.getShape().update({hidden:!0}),t.paint()}},{key:"getShape",value:function(){return this.get("graph").get("shapeMap")[this.get("id")]}},{key:"getDefaultCfg",value:function(){return{state:{},box:{},parent:"",shape:{}}}}])&&A(t.prototype,n),o&&A(t,o),e}();function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function W(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function N(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function R(t,e,n){return(R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=X(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var F=function(t){var e=t[0],n=t[1];return e===n&&0===e?"corner":0===e?"left":1===e?"right":0===n?"top":1===n&&"bottom"},q=function(t,e){var n=t.x,o=t.y;return"left"===e?n-=10:"top"===e?o-=10:"right"===e?n+=10:"bottom"===e&&(o+=10),{x:n,y:o}};function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function $(t,e){return!e||"object"!==H(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function G(t,e,n){return(G="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=U(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Z={base:B,node:function(t){function s(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),N(this,X(s).call(this,t))}var e,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(s,B),e=s,(n=[{key:"_init",value:function(){var t=this.get("graph"),e=t.get("nodeLayer"),n=this.getShapeCfg(),o=(n.parent=e).addLayer(new c.a(n));t.get("shapeMap")[this.get("id")]=o,this.getBox(),this.addLabel()}},{key:"addEdge",value:function(t,e){this.get("".concat(t,"Edges")).push(e)}},{key:"addLabel",value:function(){var t=this.get("graph"),e=this.get("label"),n=b.a.mix({offsetX:0,offsetY:0},this.get("labelCfg"));n.type="text",n.content=e,n.x=this._cfg.x+n.offsetX,n.y=this._cfg.y+n.offsetY,n.parent=this.get("id"),this.set("labelCfg",n);var o=t.addShape(n);this.set("labelId",o)}},{key:"setState",value:function(t,e){R(X(s.prototype),"setState",this).call(this,t,e),this.handleStateChange(t)}},{key:"handleStateChange",value:function(t){var e=this.get("graph");e.get("shapeMap"),this.get("state");e.autoPaint()}},{key:"updatePosition",value:function(t){R(X(s.prototype),"updatePosition",this).call(this,t);var e=this.get("graph"),n=e.get("shapeMap");this.getBox();var o=this.get("outEdges");b.a.each(o,function(t){e.findById(t).updatePath()});var i=this.get("inEdges");b.a.each(i,function(t){e.findById(t).updatePath()});var r=this.get("labelId");if(r){var a=n[r];if(a){var u=this.get("labelCfg");a.update({x:t.x+u.offsetX,y:t.y+u.offsetY})}}}},{key:"_getShapeCfg",value:function(){var t=this.get("shape");return b.a.mix(t,{x:this._cfg.x,y:this._cfg.y}),t}},{key:"getDefaultCfg",value:function(){return{x:0,y:0,state:{},box:{},parent:"",children:[],anchorMatrix:[],outEdges:[],inEdges:[],label:"",labelCfg:{}}}}])&&W(e.prototype,n),o&&W(e,o),s}(),edge:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),$(this,U(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(e,B),n=e,(o=[{key:"_init",value:function(){G(U(e.prototype),"_init",this).call(this)}},{key:"getDefaultCfg",value:function(){return{state:{},source:null,target:null,shape:{startPoint:{},endPoint:{}}}}},{key:"_getShapeCfg",value:function(){var t=this.get("shape"),e=this._getPoints();return t.points=e,t}},{key:"_getPoints",value:function(){var t=this.get("graph"),e=this.get("shape"),n=this.get("startAnchor"),o=t.findById(n),i=o.get("m"),r=o?o.getAnchorPoint():e.startPoint;this.set("startPoint",r);var a=this.get("endAnchor"),u=t.findById(a)&&"anchor"===t.findById(a).get("type")?t.findById(a):null,s=u?u.get("m"):[],c=u?u.getAnchorPoint():e.endPoint;return this.set("endPoint",c),function(t,e,n,o){var i=n.x,r=n.y,a=o.x,u=o.y,s=[{x:i,y:r}],c=F(t),l=F(e),f=q(n,c);i=f.x,r=f.y;var h=q(o,l);a=h.x,u=h.y;var p,y,g,d,v,m,b=(y=o,g=(p=n).x,d=p.y,v=y.x,m=y.y,g<v&&m<d?1:v<g&&m<d?2:v<g&&d<m?3:g<v&&d<m?4:void 0);if(s.push(f),!l){var x=Math.abs(i-a),w=Math.abs(r-u);"top"===c||"bottom"===c?1===b?w<x?(s.push({x:i,y:r-w/2}),s.push({x:a,y:r-w/2})):s.push({x:i,y:u}):2===b?w<x?(s.push({x:i,y:r-w/2}),s.push({x:a,y:r-w/2})):s.push({x:i,y:u}):3===b?w<x?(s.push({x:i,y:r+w/2}),s.push({x:a,y:r+w/2})):s.push({x:i,y:u}):4===b&&(w<x?(s.push({x:i,y:r+w/2}),s.push({x:a,y:r+w/2})):s.push({x:i,y:u})):"left"!==c&&"right"!==c||(1===b?x<w?(s.push({x:i+x/2,y:r}),s.push({x:i+x/2,y:u})):s.push({x:a,y:r}):2===b?x<w?(s.push({x:i-x/2,y:r}),s.push({x:i-x/2,y:u})):s.push({x:a,y:r}):3===b?x<w?(s.push({x:i-x/2,y:r}),s.push({x:i-x/2,y:u})):s.push({x:a,y:r}):4===b&&(x<w?(s.push({x:i+x/2,y:r}),s.push({x:i+x/2,y:u})):s.push({x:a,y:r})))}return"left"===c?1===b?"left"===l?s.push({x:i,y:u}):"top"===l?s.push({x:i,y:u}):"right"===l?(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):"bottom"===l&&s.push({x:i,y:u}):2===b?"left"===l?s.push({x:a,y:r}):"top"===l?s.push({x:i,y:u}):"right"===l?(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u})):"bottom"===l&&s.push({x:a,y:r}):3===b?"left"===l?s.push({x:a,y:r}):"top"===l?s.push({x:a,y:r}):"right"===l?(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u})):"bottom"===l&&s.push({x:i,y:u}):4===b&&("left"===l?s.push({x:i,y:u}):"top"===l?s.push({x:i,y:u}):"right"===l?(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):"bottom"===l&&s.push({x:i,y:u})):"top"===c?1===b?"left"===l?s.push({x:i,y:u}):"top"===l?s.push({x:i,y:u}):"right"===l?s.push({x:a,y:r}):"bottom"===l&&(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):2===b?"left"===l?s.push({x:a,y:r}):"top"===l?s.push({x:i,y:u}):"right"===l?s.push({x:i,y:u}):"bottom"===l&&(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):3===b?"left"===l?s.push({x:a,y:r}):"top"===l?s.push({x:a,y:r}):"right"===l?s.push({x:a,y:r}):"bottom"===l&&(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u})):4===b&&("left"===l?s.push({x:a,y:r}):"top"===l?s.push({x:a,y:r}):"right"===l?s.push({x:a,y:r}):"bottom"===l&&(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u}))):"right"===c?1===b?"left"===l?(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u})):"top"===l?s.push({x:i,y:u}):"right"===l?s.push({x:a,y:r}):"bottom"===l&&s.push({x:a,y:r}):2===b?"left"===l?(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):"top"===l?s.push({x:i,y:u}):"right"===l?s.push({x:i,y:u}):"bottom"===l&&s.push({x:i,y:u}):3===b?"left"===l?(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):"top"===l?s.push({x:i,y:u}):"right"===l?s.push({x:i,y:u}):"bottom"===l&&s.push({x:i,y:u}):4===b&&("left"===l?(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u})):"top"===l?s.push({x:a,y:r}):"right"===l?s.push({x:a,y:r}):"bottom"===l&&s.push({x:i,y:u})):"bottom"===c&&(1===b?"left"===l?s.push({x:a,y:r}):"top"===l?(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u})):"right"===l?s.push({x:a,y:r}):"bottom"===l&&s.push({x:a,y:r}):2===b?"left"===l?s.push({x:a,y:r}):"top"===l?(s.push({x:a+(i-a)/2,y:r}),s.push({x:a+(i-a)/2,y:u})):"right"===l?s.push({x:a,y:r}):"bottom"===l&&s.push({x:a,y:r}):3===b?"left"===l?s.push({x:a,y:r}):"top"===l?(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):"right"===l?s.push({x:i,y:u}):"bottom"===l&&s.push({x:i,y:u}):4===b&&("left"===l?s.push({x:i,y:u}):"top"===l?(s.push({x:i,y:u+(r-u)/2}),s.push({x:a,y:u+(r-u)/2})):"right"===l?s.push({x:a,y:r}):"bottom"===l&&s.push({x:i,y:u}))),h&&s.push(h),s.push(o),s}(i,s,r,c)}},{key:"updatePath",value:function(){var t=this.get("shape"),e=this._getPoints();t.points=e,this.updateShape()}},{key:"update",value:function(t){var e=this.getShapeCfg();b.a.mix(e,t),this.updateShape()}}])&&J(n.prototype,o),i&&J(n,i),e}()};var K=function(n){var i={insert:function(t){n.insert(t)},copy:function(){var t=n.get("targetMap").focus;n.set("copiedItem",t)},paste:function(){return n.paste(n.get("copiedItem"))},delete:function(){var t=n.get("targetMap").focus;n.removeItem(t)},tofront:function(){var t=n.get("targetMap").focus;n.tofront(t)},toback:function(){var t=n.get("targetMap").focus;n.toback(t)},undo:function(){n.undo()},redo:function(){n.redo()},zoomin:function(){n.zoomin()},zoomout:function(){n.zoomout()},fitpage:function(){n.scale(1)},fitpagewidth:function(){var t=n.get("diagramWidth"),e=n.get("width");n.scale(e/t)}};return function(t){var e=Array.from(arguments).slice(1),n=i[t].apply(i,e),o=e.pop();b.a.isFunction(o)&&o(n)}};function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function et(t,e){return!e||"object"!==Q(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ot(t,e){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var it={Graph:function(t){function n(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);return(e=et(this,nt(n).call(this)))._cfg=b.a.deepMix({containerId:null,width:1e3,height:500,diagramWidth:1e3,diagramHeight:500,ratio:1,maxRatio:1.6,minRatio:.6,nodes:[],anchors:[],edges:[],itemMap:{},shapeMap:{},data:null,eventMap:{},eventItemMap:{},targetMap:{},maxZIndex:0,selectedItem:null,dragingItem:null,hoveringItem:null,nodeLayer:null},t),e._cfg.diagramWidth=e._cfg.width,e._cfg.diagramHeight=e._cfg.height,e._init(),e}var e,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ot(t,e)}(n,s),e=n,(o=[{key:"_init",value:function(){this._initCanvas(),this._initEvent(),this.$trigger=new K(this)}},{key:"_initEvent",value:function(){new a(this)}},{key:"_initCanvas",value:function(){this.set("canvas",new g(this._cfg)),this._initGroups()}},{key:"_initGroups",value:function(){var t=this.get("canvas"),e=new c.a({x:0,y:0,parent:t}),n=new c.a({x:0,y:0,parent:t});t.addLayer(e),t.addLayer(n),this.set("nodeLayer",e),this.set("edgeLayer",n)}},{key:"addItem",value:function(t,e){var n=e.id||d();(e=b.a.mix({},{id:n},b.a.clone(e))).graph=this,e.zIndex=0,e.type=t,this.emit("beforeAddItem",e);var o=e.parent?this.findById(e.parent):null,i=new Z[t](e);return o&&o.get("children").unshift(i),console.log(i),this.get(t+"s")?this.get(t+"s").unshift(i):this.set(t+"s",[i]),this.get("itemMap")[n]=i,this.autoPaint(),this.emit("afterAddItem",i),i}},{key:"addShape",value:function(t){this.emit("beforeAddShape"),console.log(t);var e=t,n=(t.parent?this.get("shapeMap")[t.parent]:this.get("canvas")).addShape(e),o=this.get("shapeMap"),i=t.id||d();return o[i]=n,this.autoPaint(),this.emit("afterAddShape"),i}},{key:"removeItem",value:function(t){var e=this.get(t.get("type")+"s"),n=e.indexOf(t),o=this.get("shapeMap")[t.get("id")];console.log(o),o.parent.children.splice(o.parent.children.indexOf(o),1),e.splice(n,1),delete this.get("itemMap")[t.get("id")],this.autoPaint()}},{key:"updateItem",value:function(t,e){this.setAutoPaint(!1),b.a.isString(t)&&(t=this.findById(t)),t.update(e),this.setAutoPaint(!0)}},{key:"clear",value:function(){return this.get("canvas").clear(),this.set({itemMap:{},nodes:[],edges:[]}),this}},{key:"render",value:function(){var t=this,e=this.get("data");this.clear();var n=this.get("autoPaint");this.setAutoPaint(!1),b.a.each(e.nodes,function(){t.addItem("node",node)}),b.a.each(e.edges,function(){t.addItem("edge",node)}),this.paint(),this.setAutoPaint(n)}},{key:"paint",value:function(){this.emit("beforePaint"),this.get("canvas").draw(),this.emit("afterPaint")}},{key:"setAutoPaint",value:function(t){this.set("autoPaint",t),this.autoPaint()}},{key:"autoPaint",value:function(){this.get("autoPaint")&&this.paint()}},{key:"getPointByClient",value:function(t,e){var n=this.get("canvas").getBox();return this.getPointByCanvas(t-n.l,e-n.t)}},{key:"getPointByCanvas",value:function(t,e){return function(t,e){var n,o,i,r,a,u,s,c,l,f,h,p,y,g,d,v,m,b,x,w,_,k=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,S=(n=[],i=(o=e)[0],r=o[1],a=o[2],u=o[3],s=o[4],c=o[5],l=o[6],f=o[7],h=o[8],(d=i*(p=h*s-c*f)+r*(y=-h*u+c*l)+a*(g=f*u-s*l))?(d=1/d,n[0]=p*d,n[1]=(-h*r+a*f)*d,n[2]=(c*r-a*s)*d,n[3]=y*d,n[4]=(h*i-a*l)*d,n[5]=(-c*i+a*u)*d,n[6]=g*d,n[7]=(-f*i+r*l)*d,n[8]=(s*i-r*u)*d,n):null),O=[t.x,t.y,k];return b=S,x=(m=v=O)[0],w=m[1],_=m[2],v[0]=x*b[0]+w*b[3]+_*b[6],v[1]=x*b[1]+w*b[4]+_*b[7],v[2]=x*b[2]+w*b[5]+_*b[8],{x:O[0],y:O[1]}}({x:t,y:e},this.get("canvas").getMatrix())}},{key:"set",value:function(t,e){b.a.isPlainObject(t)?this._cfg=b.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}},{key:"findById",value:function(t){return this.get("itemMap")[t]}},{key:"tofront",value:function(t){if(!t)return new Error("未选中节点");var e=this.get("".concat(t.get("type"),"s")),n=e.indexOf(t);e.splice(n,1),e.unshift(t);var o=this.get("shapeMap")[t.get("id")],i=o.parent.children;n=i.indexOf(o),console.log("tofront",i.splice(n,1)),i.push(o),this.autoPaint()}},{key:"toback",value:function(t){if(!t)return new Error("未选中节点");console.log(t);var e=this.get("".concat(t.get("type"),"s")),n=e.indexOf(t);e.splice(n,1),e.push(t);var o=this.get("shapeMap")[t.get("id")],i=o.parent.children;console.log(o,i,n),n=i.indexOf(o),console.log("toback",i.splice(n,1)),i.unshift(o),this.autoPaint()}},{key:"paste",value:function(t){if(!t)return new Error("未复制节点");var e=t._cfg,n={x:e.x+20,y:e.y+20,shape:e.shape,anchorMatrix:e.anchorMatrix,label:e.label,labelCfg:e.labelCfg};return this.addItem(e.type,n)}},{key:"scale",value:function(t){var e=this.get("canvas");this.set("ratio",t),e.scale(t),this.autoPaint()}},{key:"zoomin",value:function(){var t=this.get("maxRatio"),e=this.get("ratio");console.log(e,t,e+.2<=t),e=e+.2<=t?parseFloat((e+.2).toFixed(2)):t,console.log(e,t,e+.2<=t),this.scale(e)}},{key:"zoomout",value:function(){var t=this.get("minRatio"),e=this.get("ratio");e=t<=e-.2?parseFloat((e-.2).toFixed(2)):t,this.scale(e)}}])&&tt(e.prototype,o),i&&tt(e,i),n}(),Item:Z,registerNode:function(t,e){Z[t]=e(Z.base)}};e.default=it},function(t,e,n){"use strict";n.r(e);n(6),n(15),n(17);var i,r="";document.addEventListener?i="addEventListener":document.attachEvent&&(i="attachEvent",r="on");var a=function(t,e,n,o){t[i](r+e,n,o)},g=n(0),o=function(t){this.dom=t};o.prototype={append:function(t){return this.dom.appendChild(t.dom),this},prepend:function(t){return this.dom.insertBefore(t.dom,this.dom.childNodes[0]),this},insertBefore:function(t){return t.dom.parentNode.insertBefore(this.dom,t.dom),this},remove:function(){return this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this},css:function(t,e){if(g.a.isPlainObject(t)){var n=t;for(var o in n)this.dom.style[o]=n[o]}else this.dom.style[t]=e;return this},addClass:function(t){return this.dom.classList.add(t),this},removeClass:function(t){return this.dom.classList.remove(t),this},show:function(){return this.dom.style.display="block",this},hide:function(){return this.dom.style.display="none",this},attrs:function(t){for(var e in t)this.dom.setAttribute(e,t[e]);return this},props:function(t){for(var e in t)this.dom[e]=t[e];return this},html:function(t){return t||""===t?(this.dom.innerHTML=t,this):this.dom.innerHTML},text:function(t){return t?(this.dom.textContent=t,this):this.dom.textContent},on:function(t,e,n){return a(this.dom,t,e,n),this},onWheel:function(t,e){return function(t,e,n){var o="wheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";a.apply(this,[t,o,function(t){e({originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaX:t.wheelDeltaX?-.025*t.wheelDeltaX:0,deltaY:t.wheelDelta?-.025*t.wheelDelta:t.deltaY||t.detail,preventDefault:function(){t.preventDefault?t.preventDefault:t.returnValue=!1}})},n])}(this.dom,t,e),this},height:function(t){return"boolean"==typeof t&&t?this.dom.offsetHeight:"number"!=typeof t?this.dom.clientHeight:void(this.dom.style.height=t+"px")},width:function(t){return"boolean"==typeof t&&t?this.dom.offsetWidth:"number"!=typeof t?this.dom.clientWidth:void(this.dom.style.width=t+"px")}};var u=o,s=function(t){return g.a.isDom(t)||t instanceof DocumentFragment||t.window===window?new u(t):new u(document.querySelector(t))},c=function e(t,n){var o=s(document.createElement(t.tag));for(var i in n=n||{},t.attrs&&o.attrs(t.attrs),t.props&&o.props(t.props),t.style&&o.css(t.style),t.evts)o.on(i,t.evts[i]);return t.children&&t.children.forEach(function(t){o.append(e(t,n))}),t.ref&&(n[t.ref]=o),o};n(2);var l=n(4);function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),t}function d(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function v(t,e,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function b(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var w={},_={x:150,y:75,shape:{type:"rect",size:[100,100],style:{stroke:"#00678a",fill:"#eee",lineWidth:2}},props:{key:"start",value:"Start"},anchorMatrix:[[.5,0],[1,.5],[.5,1],[0,.5]],label:"开始",labelCfg:{offsetY:80,style:{color:"#F00",size:"14px"}}},k={shape:{type:"circle",size:50,style:{stroke:"#00678a",fill:"#eee",lineWidth:2}},props:{key:"wait",value:"wait"},anchorMatrix:[[.5,0],[1,.5],[.5,1],[0,.5]],outlineCfg:{type:"line",style:{stroke:"#000",lineWidth:2,lineDash:[8,8]}}},S={shape:{type:"diamond",size:[100,100],style:{stroke:"#00678a",fill:"#eee",lineWidth:2}},props:{key:"end",value:"end"},anchorMatrix:[[.5,0],[1,.5],[.5,1],[0,.5]],outlineCfg:{type:"rect",size:[120,120],style:{stroke:"#000",lineWidth:2,lineDash:[8,8]}}},O={shape:{size:5,style:{lineWidth:2,stroke:"#00678a",fill:"#FFF"}},stateShapeMap:{default:{size:5,style:{lineWidth:2,stroke:"#00678a",fill:"#FFF"}},active:{size:15,style:{lineWidth:2,stroke:"#CCC",fill:"#FFB2B2"}},hover:{size:15,style:{lineWidth:2,stroke:"#CCC",fill:"#FFB2B2"}},visited:{size:5,style:{lineWidth:2,stroke:"#CCC",fill:"#FFB2B2"}}}};function P(r,e,a){r.on("stateChange",function(t,e,n){var o=this.get("graph").get("targetMap"),i=this.get("children");"hover"===t&&o.focus!==this&&g.a.each(i,function(t){e?t.show():t.hide()}),"focus"===t&&(o.focus=e?this:null,g.a.each(i,function(t){e?t.show():t.hide()}))}),r.on("mouseenter",function(t){e.canvas.css("cursor","move")}),r.on("mousemove",function(t){}),r.on("mouseleave",function(t){e.canvas.css("cursor","auto")}),r.on("mousedown",function(t){!0}),r.on("click",function(t){}),r.on("mouseup",function(t){!1});var u={x:0,y:0},s={x:0,y:0};r.on("dragstart",function(t){var e=t.target;u.x=e._cfg.x,u.y=e._cfg.y,s=a.get("downPoint")}),r.on("drag",function(t){var e=t.clientX,n=t.clientY,o=s.x,i=s.y;a.setAutoPaint(!1),a.updateItem(r,{x:u.x+(e-o),y:u.y+(n-i)}),g.a.each(r.get("children"),function(t){t.updatePosition()}),a.setAutoPaint(!0)}),r.on("drop",function(t){})}function j(n){var t={mousedown:function(t){console.log("anchor mousedown",t)},mouseenter:function(t){console.log("anchor mouseenter");for(var e=this.get("graph"),n=e.findById(this.get("parent"));n;)n.setState("hover",!0),n=e.findById(n.get("parent"));this.update()},mouseleave:function(t){for(var e=this.get("graph"),n=e.findById(this.get("parent"));n;)n.setState("hover",!1),n=e.findById(n.get("parent"));this.update()},dragstart:function(t){var e=this.get("graph"),n=t.clientX,o=t.clientY,i=e.addItem("edge",{source:this.get("parent"),target:null,startAnchor:this.get("id"),endPoint:{x:n,y:o},shape:{type:"polyline",style:{stroke:"#00678a",lineWidth:3}}});e.set("activeEdge",i)},drag:function(t){var e=this.get("graph").get("activeEdge"),n=t.clientX,o=t.clientY;e.update({endPoint:{x:n,y:o}})},drop:function(t){console.log("anchor drop",t,this);var e,n=this.get("graph"),o=n.get("activeEdge");if(t.target&&"anchor"===t.target.get("type")){var i=n.findById(o.get("source")),r=t.target,a=n.findById(r.get("parent"));o.set("target",r.get("parent")),o.set("endAnchor",r.get("id"));var u=o.get("id");i.addEdge("out",u),a.addEdge("in",u),o.updatePath(),n.findById(o.get("startAnchor")).setState("visited",!0),r.setState("visited",!0),(e=o).on("mouseenter",function(t){var e=this.get("startPoint"),n=this.get("endPoint"),o=t.clientX,i=t.clientY;Math.abs(o-e.x)<5||Math.abs(o-n.x)<5?w.canvas.css("cursor","col-resize"):Math.abs(i-e.y)<5||Math.abs(i-n.y)<5?w.canvas.css("cursor","row-resize"):w.canvas.css("cursor","col-resize"),console.log(this,o,i)}),e.on("mouseover",function(){console.log("edge mouseover")}),e.on("mouseleave",function(){w.canvas.css("cursor","auto")}),e.on("mousedown",function(t){console.log("edge mousedown")}),e.on("dragenter",function(){console.log("edge dragenter")})}else n.removeItem(o);n.set("activeEdge",null)},dragenter:function(t){var e=t.target,n=this.get("graph").get("activeEdge");n&&(n.set("target",e.get("parent")),n.set("endAnchor",e.get("id"))),this.update()},dragleave:function(t){var e=this.get("graph").get("activeEdge");e&&(e.set("target",null),e.set("endAnchor",null)),this.update()},mouseup:function(t){console.log("anchor mouseup",t,this)}};g.a.each(t,function(t,e){n.on(e,t)})}l.default.registerNode("anchor",function(n){return function(t){function e(){return h(this,e),d(this,m(e).apply(this,arguments))}return b(e,n),y(e,[{key:"_init",value:function(){var t=this.getAnchorPoint();this._cfg.x=t.x,this._cfg.y=t.y,v(m(e.prototype),"_init",this).call(this)}},{key:"isPointIn",value:function(t){return this.pointDistance({x:this._cfg.x,y:this._cfg.y},t)<225}},{key:"pointDistance",value:function(t,e){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}},{key:"_getShapeCfg",value:function(){var t=this.get("state"),n=this.get("stateShapeMap"),o=this.get("shape");return o.x=this._cfg.x,o.y=this._cfg.y,o=g.a.mix(o,n.default),g.a.each(t,function(t,e){t&&g.a.mix(o,n[e])}),o.hidden=this.get("hidden"),o}},{key:"getDefaultCfg",value:function(){return{state:{},hidden:!1,shape:{size:5,type:"circle",style:{lineWidth:2,stroke:"#CCC",fill:"#FFF"}}}}},{key:"updatePosition",value:function(){var t=this.getAnchorPoint(this.get("m"));delete t.m,this._cfg.x=t.x,this._cfg.y=t.y,this.getShape().update(t)}},{key:"getAnchorPoint",value:function(){var t=this.get("graph").findById(this.get("parent")).get("box"),e=this.get("m");return{x:t.l+t.width*e[0],y:t.t+t.height*e[1],m:e}}}]),e}()}),l.default.registerNode("outline",function(n){return function(t){function e(){return h(this,e),d(this,m(e).apply(this,arguments))}return b(e,n),y(e,[{key:"_getShapeCfg",value:function(){var t=this.get("state"),n=this.get("stateShapeMap"),o=this.get("shape");return o.x=this._cfg.x,o.y=this._cfg.y,(o=g.a.mix(o,n.default)).points=this.getPoints(),g.a.each(t,function(t,e){t&&g.a.mix(o,n[e])}),o.hidden=this.get("hidden"),o}},{key:"getPoints",value:function(){var t=this.get("graph"),e=this.get("parent"),n=t.findById(e).get("box");return[{x:n.l-10,y:n.t-10},{x:n.r+10,y:n.t-10},{x:n.r+10,y:n.b+10},{x:n.l-10,y:n.b+10},{x:n.l-10,y:n.t-10}]}},{key:"getDefaultCfg",value:function(){return{state:{},stateShapeMap:{},hidden:!1,shape:{type:"line",style:{stroke:"#333",lineWidth:3,lineDash:[8,8],points:[]}}}}},{key:"updatePosition",value:function(){this.getShape().update({points:this.getPoints()})}}]),e}()});var E=l.default,M=function(i){var p=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a={list:[],maps:{}},n=c({tag:"div",ref:"sidebar",props:{className:"kgraph-sidebar-container"}},p),o=function(t,e){var n=c({tag:"div",props:{className:"sidebar-section-item item-"+e.key},children:[{tag:"i",ref:"icontext",props:{className:"iconfont",innerHTML:e.iconText}},{tag:"span",props:{innerText:e.text}}]},p);t.append(n),e.width=140,e.height=40,e.icon=p.icontext.text(),e.text=e.text;var o,i,r=(o=e,(i=function(t,e){this.isEdited=o.isEdited,Node.apply(this,[t,e])}).prototype=Object.create(Node.prototype),Object.assign(i.prototype,o),i.prototype.constructor=i);a.list.push(r),a.maps[e.key]=r,u(e,n)},u=function(a,t){var u,s={},c=!1,l=!1,f=[],h=1,o=function(t){var e=t.clientX,n=t.clientY;if(t.pageX,t.pageY,!c){if(!(10<Math.abs(s.x-e)||10<Math.abs(s.y-n)))return!1;c=!0,u=y(a,s.x,s.y),p.container.css("cursor","move")}var o=(l=e>f.l&&e<f.r&&n>f.t&&n<f.b)?h:1,i=e-s.x,r=n-s.y;u.css({transform:"translate("+i+"px, "+r+"px) scale("+o+")"})},e=function t(e){if(l){var n=i.getPointByClient(e.clientX,e.clientY);P(i.addItem("node",g.a.extend(a.item,{x:n.x,y:n.y,label:a.text})),p,i)}p.container.css("cursor","auto"),document.documentElement?document.documentElement.scrollLeft:document.body.scrollLeft,document.documentElement?document.documentElement.scrollTop:document.body.scrollTop,u&&(u.remove(),u=null),c=!1,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t)};t.on("mousedown",function(t){1===t.which&&(s.x=t.clientX,s.y=t.clientY,f=i.get("canvas").getBox(),h=i.get("canvas").get("ratio"),document.addEventListener("mousemove",o),document.addEventListener("mouseup",e))})},y=function(t,e,n){var o=0,i=0,r=t.item.shape;"circle"===r.type?(o=2*r.size,i=2*r.size):"rect"!==r.type&&"diamond"!==r.type||(o=r.size[0],i=r.size[1]);var a=c({tag:"div",style:{width:o+"px",height:i+"px",border:"1px dashed #333",position:"absolute",left:e-o/2+"px",top:n-i/2+"px",zIndex:999,transform:"translate(0, 0)"}});return s("body").append(a),a};return c({tag:"i",props:{className:"button-open-sidebar iconfont icon-fenlei1"},ref:"buttonOpenSlidebar",evts:{click:function(){n.removeClass("collapse"),setTimeout(function(){i.resize()},200)}}},p),n.append(p.buttonOpenSlidebar),{createSection:function(t,e){c({tag:"div",props:{className:"sidebar-section"},ref:"sidebarSection",children:[{tag:"div",props:{className:"sidebar-section-title"},children:[{tag:"i",props:{className:"iconfont icon-fenlei1"},evts:{click:function(){n.addClass("collapse"),setTimeout(function(){i.resize()},200)}}},{tag:"span",props:{innerText:t}}]},{tag:"div",ref:"seciontItems",props:{className:"sidebar-section-items"}}]},p),e.forEach(function(t){o(p.seciontItems,t)}),n.append(p.sidebarSection)}}},C=[{key:"undo",title:"撤销"},{key:"redo",title:"重做"},{key:"cutOff"},{key:"copy",title:"复制"},{key:"paste",title:"粘贴"},{key:"delete",title:"删除"},{key:"cutOff"},{key:"zoomin",title:"放大"},{key:"zoomout",title:"缩小"},{key:"cutOff"},{key:"fitpagewidth",title:"适应画布"},{key:"fitpage",title:"实际尺寸"},{key:"cutOff"},{key:"tofront",title:"前置"},{key:"toback",title:"后置"}],I=function(r){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},u=(c({tag:"div",ref:"toolbar",props:{className:"kgraph-toolbar-container"}},a),{list:[],maps:{}}),t=function(){var t=$state.getStateId(),e=$state.getLength();u.maps.undo.config.disabled=0===t,u.maps.redo.config.disabled=e-1<=t},e=function(){var t=!r.getSelectedNode();u.maps.copy.config.disabled=t,u.maps.paste.config.disabled=t,u.maps.delete.config.disabled=t,u.maps.tofront.config.disabled=t,u.maps.toback.config.disabled=t},n=function(){u.list.forEach(function(t){return t.dom[t.config.disabled?"addClass":"removeClass"]("disabled")})};return c({tag:"div",ref:"tools",props:{className:"kgraph-toolbar"}},a),C.forEach(function(t){var e,n,o,i;"cutOff"===t.key?(i=c({tag:"div",props:{className:"cut-off"}}),a.tools.append(i)):!t.hidden&&(n=c({tag:"div",props:{title:(e=t).title,className:"iconfont icon-"+e.key+" disabled"},evts:{click:function(){r.$trigger(e.key,function(t){"paste"===e.key&&(console.log(a),P(t,a,r))})}}}),o={name:e.key,config:e,dom:n},u.maps[e.key]=o,u.list.push(o),a.tools.append(n))}),a.toolbar.append(a.tools),{updateTools:function(){t(),e(),n()}}};window.onload=function(){var t=s("#kgraph-container-test");w.container=t;var e=c({tag:"div",props:{className:"kgraph-diagram-container"},children:[{tag:"div",props:{className:"kgraph-diagram"},children:[{tag:"canvas",ref:"canvas",props:{id:"kgraph-canvas"}}]}]},w);t.append(e);var n,o,i=(n={containerId:"kgraph-canvas",width:window.innerWidth-210,height:window.innerHeight-40},(o=new E.Graph(n,"Root")).setAutoPaint(!0),o.on("beforeAddItem",function(){}),o.on("afterAddItem",function(e){if("edge"===e.get("type"))e.on("mousedown",function(t,e){});else if("node"===e.get("type")){var t=e.get("box");o.addItem("outline",{x:t.x,y:t.y,parent:e.get("id"),hidden:!0}),g.a.each(e.get("anchorMatrix"),function(t){O.m=t,O.parent=e.get("id"),O.hidden=!0,j(o.addItem("anchor",O))})}console.log(o)}),o.on("mousedown",function(t){console.log("graph mousedown",t)}),o);console.log(i),P(i.addItem("node",_),w,i);var r=new M(i,w);new I(i,w);console.log(w),t.append(w.sidebar),t.append(w.toolbar),r.createSection("基础流程节点",[{key:"start",text:"开始",value:"start",iconText:"&#xe6ec;",item:_},{key:"wait",text:"等待",value:"wait",iconText:"&#xe644;",item:k},{key:"time",text:"结束",value:"time",iconText:"&#xe69d;",item:S}]),t.on("mousedown",function(t){t.preventDefault()}),t.on("mousemove",function(t){t.preventDefault()}),t.on("contextmenu",function(t){t.preventDefault()})}},function(t,e){},,,,,,,,,function(t,e){},,function(t,e){}]);