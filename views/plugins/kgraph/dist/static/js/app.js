!function(n){var i={};function r(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}r.m=n,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=function(t){var e=i(t);return null!==t&&"object"===e||"function"===e},r=function(t,e){return{}.toString.call(t)==="[object ".concat(e,"]")},s=function(t){return r(t,"Array")},a=function(t,e){if(t)if(s(t))for(var n=0,i=t.length;n<i&&!1!==e(t[n],n);n++);else if(o(t))for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r))break};function u(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(){var t=Array.from(arguments),e=t.shift();return Object.assign?Object.assign.apply(Object,[e].concat(u(t))):K.each(t,function(t){!function(t,e){for(var n in e)t[n]=e[n]}(e,t)}),e};function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var h=function t(e){if("object"!==l(e)||null===e)return e;var n;if(s(e)){n=[];for(var i=0,r=e.length;i<r;i++)"object"===l(e[i])&&null!=e[i]?n[i]=t(e[i]):n[i]=e[i]}else for(var o in n={},e)"object"===l(e[o])&&null!=e[o]?n[o]=t(e[o]):n[o]=e[o];return n},f=n(4),p=n.n(f),g=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},y=function(t,n){if(!g(t))return t;var i=[];return a(t,function(t,e){i.push(n(t,e))}),i};function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var v=function(t){return"object"===d(t)&&null!==t},b=function(t){if(!v(t)||!r(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},m=function t(e,n,i,r){for(var o in i=i||0,r=r||5,n)if(n.hasOwnProperty(o)){var a=n[o];null!==a&&b(a)?(b(e[o])||(e[o]={}),i<r?t(e[o],a,i+1,r):e[o]=n[o]):s(a)?(e[o]=[],e[o]=e[o].concat(a)):void 0!==a&&(e[o]=a)}},x=function(){for(var t=new Array(arguments.length),e=t.length,n=0;n<e;n++)t[n]=arguments[n];for(var i=t[0],r=1;r<e;r++)m(i,t[r]);return i},w=Object.prototype.hasOwnProperty,k=function(e,t){if(null===e||!b(e))return{};var n={};return a(t,function(t){w.call(e,t)&&(n[t]=e[t])}),n},_=function(t,n){if(!g(t))return t;var i=[];return a(t,function(t,e){n(t,e)&&i.push(t)}),i},S=function(t){return r(t,"Function")},P=Object.keys?function(t){return Object.keys(t)}:function(n){var i=[];return a(n,function(t,e){S(n)&&"prototype"===e||i.push(e)}),i},O=function(t){return null==t};var E=function(t,e){var n=P(e),i=n.length;if(O(t))return!i;for(var r=0;r<i;r+=1){var o=n[r];if(e[o]!==t[o]||!(o in t))return!1}return!0};var j=function(t,e){var n;if(S(e)&&(n=e),b(e)&&(n=function(t){return E(t,e)}),n)for(var i=0;i<t.length;i+=1)if(n(t[i]))return t[i];return null},M=function(t,n,e){if(!s(t)&&!b(t))return t;var i=e;return a(t,function(t,e){i=n(i,t,e)}),i};function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var D="object"===("undefined"==typeof HTMLElement?"undefined":C(HTMLElement))?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"===C(t)&&1===t.nodeType&&"string"==typeof t.nodeName},z=function(t){return"string"==typeof t},I={}.toString,T=function(t){return I.call(t).replace(/^\[object /,"").replace(/\]$/,"")},A=Object.prototype,L=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||A)},B=Object.prototype.hasOwnProperty;var X=function(t){if(O(t))return!0;if(g(t))return!t.length;var e=T(t);if("Map"===e||"Set"===e)return!t.size;if(L(t))return!Object.keys(t).length;for(var n in t)if(B.call(t,n))return!1;return!0},Y={isDom:D,isArray:s,isArrayLike:g,isString:z,isObjectLike:v,isPlainObject:b,isFunction:S,isEmpty:X,isNil:O,isPrototype:L,getType:T},R=function(t,e){return(t%e+e)%e};var W=function(t){return g(t)?Array.prototype.slice.call(t):[]},N=function(t){for(var e=W(arguments),n=1;n<e.length;n++){var i=e[n];S(i)&&(i=i.prototype),p()(t.prototype,i)}},H=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},F={find:j,reduce:M,each:a,filter:_,extend:c,clone:h,mix:p.a,map:y,deepMix:x,pick:k,mod:R,augment:N,toArray:W,toUpperFirst:H};p()(F,Y);var K=e.a=F},function(t,e){var a={};a.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},a.angle=function(t,e){var n,i,r,o=a.dot(t,e)/(a.length(t)*a.length(e));return Math.acos((n=o)<(i=-(r=1))?i:r<n?r:n)},a.direction=function(t,e){return t[0]*e[1]-e[0]*t[1]},a.angleTo=function(t,e,n){var i=a.angle(t,e),r=0<=a.direction(t,e);return n?r?2*Math.PI-i:i:r?i:2*Math.PI-i},a.vertical=function(t,e,n){return t[1]=n?(t[0]=e[1],-1*e[0]):(t[0]=-1*e[1],e[0]),t},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},a.normalize=function(t,e){var n=e[0],i=e[1],r=n*n+i*i;return 0<r&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},a.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},a.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},a.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)},t.exports=a},function(t,e,n){"use strict";var o=n(3);e.a=function e(t,n){var i=Object(o.a)(document.createElement(t.tag));for(var r in n=n||{},t.attrs&&i.attrs(t.attrs),t.props&&i.props(t.props),t.style&&i.css(t.style),t.evts)i.on(r,t.evts[r]);return t.children&&t.children.forEach(function(t){i.append(e(t,n))}),t.ref&&(n[t.ref]=i),i}},function(t,e,n){"use strict";var r,o="";document.addEventListener?r="addEventListener":document.attachEvent&&(r="attachEvent",o="on");var a=function(t,e,n,i){t[r](o+e,n,i)};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=function(t){this.dom=t};i.prototype={append:function(t){return this.dom.appendChild(t.dom),this},prepend:function(t){return this.dom.insertBefore(t.dom,this.dom.childNodes[0]),this},insertBefore:function(t){return t.dom.parentNode.insertBefore(this.dom,t.dom),this},remove:function(){return this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this},css:function(t,e){if("object"===s(t)){var n=t;for(var i in n)this.dom.style[i]=n[i]}else this.dom.style[t]=e;return this},hasClass:function(t){return this.dom.classList.contains(t)},addClass:function(t){return this.dom.classList.add(t),this},removeClass:function(t){return this.dom.classList.remove(t),this},toggleClass:function(t){return this.hasClass(t)?this.removeClass(t):this.addClass(t),this},show:function(){return this.dom.style.display=this.display,this.isHide=!1,this},hide:function(){return!this.isHide&&(this.display=(t=this.dom,e="display",(window.getComputedStyle?e?window.getComputedStyle(t,null)[e]:window.getComputedStyle(t,null):e?t.currentStyle[e]:t.currentStyle)||"block"),this.dom.style.display="none",this.isHide=!0,this);var t,e},toggle:function(){return this.isHide?this.show():this.hide(),this},attrs:function(t){for(var e in t)this.dom.setAttribute(e,t[e]);return this},props:function(t){for(var e in t)this.dom[e]=t[e];return this},html:function(t){return t||""===t?(this.dom.innerHTML=t,this):this.dom.innerHTML},text:function(t){return t?(this.dom.textContent=t,this):this.dom.textContent},on:function(t,e,n){return a(this.dom,t,e,n),this},onWheel:function(t,e){return function(t,e,n){var i="wheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";a.apply(this,[t,i,function(t){e({originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaX:t.wheelDeltaX?-.025*t.wheelDeltaX:0,deltaY:t.wheelDelta?-.025*t.wheelDelta:t.deltaY||t.detail,preventDefault:function(){t.preventDefault?t.preventDefault:t.returnValue=!1}})},n])}(this.dom,t,e),this},height:function(t){return"boolean"==typeof t&&t?this.dom.offsetHeight:"number"!=typeof t?this.dom.clientHeight:void(this.dom.style.height=t+"px")},width:function(t){return"boolean"==typeof t&&t?this.dom.offsetWidth:"number"!=typeof t?this.dom.clientWidth:void(this.dom.style.width=t+"px")},getBoundingClientRect:function(){return this.dom.getBoundingClientRect()}};var u=i,c=n(0);e.a=function(t){return c.a.isDom(t)||t instanceof DocumentFragment||t.window===window?new u(t):new u(document.querySelector(t))}},function(t,e){function r(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}t.exports=function(t,e,n,i){return e&&r(t,e),n&&r(t,n),i&&r(t,i),t}},function(t,e,n){"use strict";var m=n(0);function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var o=["click","mousedown","mouseup","dblclick","contextmenu","mouseenter","mouseout","mouseover","mousemove","mouseleave","dragstart","dragend","drag","dragenter","dragleave","drop","focus","blur"],a=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.graph=t,this.record={},this._initEvents()}var t,n,i;return t=e,(n=[{key:"_initEvents",value:function(){var e=this.graph,n=(e.get("container"),e.get("canvas").get("canvas")),i=this._canvasEvent();m.a.each(o,function(t){document.addEventListener(t,function(t){t.target.id===n.id?i(t):"mousedown"===t.type&&e.get("state").focus&&(e.emit("blur",{type:"blur",clientX:t.clientX,clientY:t.clientY,origin:t}),e.setState("focus",!1))})})}},{key:"_canvasEvent",value:function(){var e=this;return function(t){e._handleEvents({type:t.type,clientX:t.clientX,clientY:t.clientY,origin:t})}}},{key:"_handleEvents",value:function(r){var t=r.type,e=this.graph,n=e.get("nodes"),i=e.get("edges"),o=(e.get("eventItemMap"),e.get("activeEdge")),a=e.get("targetMap").drag,s=e.getPointByClient(r.clientX,r.clientY);r.clientX=s.x,r.clientY=s.y;var u=[];if(m.a.each(n.concat(i),function(t){var e=t.get("children"),n=e?m.a.find(e,function(t){return t.isPointIn(s)&&t.get("event")}):null,i=!1;if(n?(i=!0,t=n):i=t.isPointIn(s),i&&o!==t&&a!==t&&t.get("event"))return r.target=t,u.push(t),!1}),r.items=u,"mousemove"===t)this._handleEventMousemove(r,u);else if("mousedown"===t)this.record.mousedown={timestamp:Date.now(),point:s},this._handleEventMousedown(r,u);else if("mouseup"===t)this._handleEventMouseup(r,u);else if("click"!==t){if(u.length)u[0].emit(t,r)}if("click"===t&&(300<Date.now()-this.record.mousedown.timestamp||Math.abs(this.record.mousedown.point.x-s.x)||Math.abs(this.record.mousedown.point.y-s.y)))return!1;e.emit(t,r);var c=e.get("state");"mousedown"!==t||c.focus||(e.emit("focus",r),e.setState("focus",!0))}},{key:"_handleEventMousedown",value:function(t,e){var n=this.graph.get("targetMap"),i=e[0];i&&(n.mousedown=i,this.downPoint={x:t.clientX,y:t.clientY},i.emit("mousedown",t))}},{key:"_handleEventMouseup",value:function(t,e){var n=this.graph.get("targetMap"),i=e[0],r=!1;n.focus&&(n.focus=m.a.filter(n.focus,function(t){return t==i||(t.setState("focus",!1),!1)})),n.mousedown&&(n.mousedown=null),n.drag&&(r=!0,n.drag.emit("drop",t),n.drag.emit("dragend",t),n.drag=null),i&&!r&&((Date.now()-this.record.mousedown.timestamp<300||Math.abs(this.record.mousedown.point.x-t.clientX)<10&&Math.abs(this.record.mousedown.point.y-t.clientY)<10)&&(i.setState("focus",!0),n.focus=[i],i.emit("click",t)),i.emit("mouseup",t))}},{key:"__handleEventMousemove",value:function(t,e){var n=this.graph,i=n.get("targetMap"),r=e[0],o=!1,a=i.mousedown,s=i.mouseenter,u=i.dragenter,c=i.drag;if(a&&!c){var l=n.get("downPoint");this._isDragStart([l,{x:t.clientX,y:t.clientY}])&&(i.drag=a).emit("dragstart",t)}else c?(o=!0,c.emit("drag",t)):!a&&s&&(!s.isPointIn({x:t.clientX,y:t.clientY})||r&&s!==r)&&(i.mouseenter=null,s.setState("hover",!1),s.emit("mouseleave",t),s=null);u&&!u.isPointIn({x:t.clientX,y:t.clientY})&&(i.dragenter=null,u.setState("hover",!1),u.emit("dragleave",t)),r&&(o?(u||c===r||n.get("activeEdge")===r||((i.dragenter=r).setState("hover",!0),r.emit("dragenter",t)),r.emit("mousemove",t)):i.mouseenter!==r&&(!a&&s&&(s.setState("focus",!1),s.emit("mouseleave",t)),r.setState("hover",!0),(i.mouseenter=r).emit("mouseenter",t)))}},{key:"_handleEventMousemove",value:function(t){var e=this.graph.get("targetMap"),n=e.mousedown,i=e.mouseenter,r=e.drag,o=e.dragenter,a=t.items[0];if(n&&!r){var s=this.downPoint;this._isDragStart([s,{x:t.clientX,y:t.clientY}])&&(e.drag=n).emit("dragstart",{clientX:s.x,clientY:s.y,target:n,origin:t.origin})}r?(r.emit("drag",t),o!==a&&(o&&this._handleEventDragleave(t),a&&this._handleEventDragenter(t))):r||i!==a&&(i&&this._handleEventMouseleave(t),a&&this._handleEventMouseenter(t))}},{key:"_handleEventMouseenter",value:function(t){var e=this.graph,n=e.get("targetMap"),i=t.items[0];n.mouseenter=i;for(var r=(parent=i).get("cancelBubble");parent;){if(parent.get("state").hover)break;(parent===i||parent!==i&&!r)&&parent.emit("mouseenter",t),parent.setState("hover",!0),parent=e.findById(parent.get("parent"))}}},{key:"_handleEventMouseleave",value:function(t){var e=this.graph,n=e.get("targetMap"),i=n.mouseenter,r=t.items[0],o=!!r&&(i.hasParent(r.get("id"))||r.hasParent(i.get("id")));n.mouseenter=null;for(var a=i;a;){if(o&&a.isPointIn({x:t.clientX,y:t.clientY})){n.mouseenter=a;break}a.setState("hover",!1),a.emit("mouseleave",t),a=e.findById(a.get("parent"))}}},{key:"_handleEventDragenter",value:function(t){var e=this.graph,n=e.get("targetMap"),i=t.items[0];n.dragenter=i;for(var r=(parent=i).get("cancelBubble");parent;){if(parent.get("state").hover)break;(parent===i||parent!==i&&!r)&&parent.emit("dragenter",t),parent.setState("hover",!0),parent=e.findById(parent.get("parent"))}}},{key:"_handleEventDragleave",value:function(t){var e=this.graph,n=e.get("targetMap"),i=n.dragenter,r=t.items[0],o=!!r&&(i.hasParent(r.get("id"))||r.hasParent(i.get("id")));n.dragenter=null;for(var a=i;a;){if(o&&a.isPointIn({x:t.clientX,y:t.clientY})){n.dragenter=a;break}a.setState("hover",!1),a.emit("dragleave",t),a=e.findById(a.get("parent"))}}},{key:"_isDragStart",value:function(t){return 5<Math.abs(t[0].x-t[1].x)||5<Math.abs(t[0].y-t[1].y)}},{key:"getDefaultOption",value:function(){return{cancelBubble:!0}}}])&&r(t.prototype,n),i&&r(t,i),e}(),s=Array.prototype.slice;var i=function(){};m.a.augment(i,{on:function(t,e,n){var i=this;if(!m.a.isFunction(e))throw new TypeError("listener should be a function");return i._cfg._events||(i._cfg._events={}),i._cfg._events[t]||(i._cfg._events[t]=[]),i._cfg._events[t].push({callback:e,one:n}),this},one:function(t,e){return this.on(t,e,!0),this},emit:function(t){if(!this.get("destroyed")&&this._cfg._events&&!m.a.isEmpty(this._cfg._events)){var e=this._cfg._events[t];if(!m.a.isEmpty(e))for(var n=arguments,i=s.call(n,1),r=e.length,o=0;o<r;)e[o]&&(e[o].callback.apply(this,i),e[o]&&e[o].one?(e.splice(o,1),r--):o++)}},trigger:function(){this.emit.apply(this,arguments)},off:function(t,e){var n=this._cfg._events;if(n&&!m.a.isEmpty(n)){if(0===arguments.length)return this._cfg._events={},this;if(n[t]){var i=function(t,e){for(var n=t.length;n--;)if(t[n].callback===e)return n;return-1}(n[t],e);0<=i&&n[t].splice(i,1),0===n[t].length&&delete n[t]}}},removeEvent:function(t){return void 0===t?this._cfg._events={}:delete this._cfg._events[t],this},_getEvents:function(){return this._cfg._events||{}}});var u=i;function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._cfg=m.a.mix(this.getDefaultCfg(),t),this.set("style",this.getShapeStyle())}var t,n,i;return t=e,(n=[{key:"draw",value:function(){}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}},{key:"updatePosition",value:function(t,e){this._cfg.x=t,this._cfg.y=e}},{key:"update",value:function(t){this._cfg=m.a.deepMix(this._cfg,t),this.set("style",this.getShapeStyle())}},{key:"getDefaultCfg",value:function(){return{x:0,y:0,size:10}}},{key:"getShapeStyle",value:function(){return{}}}])&&c(t.prototype,n),i&&c(t,i),e}(),h=function(t,e,n){!function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:5;t.moveTo(e[0].x,e[0].y);for(var i=1,r=e.length;i<r;i++){var o=e[i],a=e[i+1];a||(a=e[0]),t.arcTo(o.x,o.y,a.x,a.y,n)}}(t,e,n)};function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var v=function(t,e,n){!function(t,e,n,i,r,o,a,s,u){a=void 0!==(o=void 0!==o?o:30)?a:10,s=void 0!==s?s:1,u="color"!=typeof u?u:"#000";var c=180*Math.atan2(n-r,e-i)/Math.PI,l=(c+o)*Math.PI/180,h=(c-o)*Math.PI/180,f=a*Math.cos(l),p=a*Math.sin(l),g=a*Math.cos(h),y=a*Math.sin(h);t.save(),t.beginPath();var d=e-f,v=n-p;t.moveTo(d,v),d=i+f,v=r+p,t.moveTo(d,v),t.lineTo(i,r),d=i+g,v=r+y,t.lineTo(d,v),t.fillStyle=u,t.lineWidth=s,t.closePath(),t.fill(),t.restore()}(t,e[0].x,e[0].y,e[1].x,e[1].y,30,20,n.lineWidth,n.color)};function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function w(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var S=function(t,e){t.moveTo(e[0].x,e[0].y);for(var n=1,i=e.length;n<i;n++)t.lineTo(e[n].x,e[n].y)};function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function E(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function D(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function z(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function A(t){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function B(t,e){return!e||"object"!==A(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function W(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function N(t,e){return!e||"object"!==R(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var K={rect:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,y(e).call(this,t))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(e,l),n=e,(i=[{key:"draw",value:function(t){var e=this.get("style");this._draw(t,e)}},{key:"_draw",value:function(t,e){t.save(),e.lineDash&&t.setLineDash(e.lineDash),t.beginPath(),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.lineWidth=e.lineWidth,e.borderRadius?(h(t,this.getPoints(e),e.borderRadius),t.closePath(),e.stroke&&t.stroke(),e.fill&&t.fill()):(e.fill&&t.fillRect(e.x,e.y,e.width,e.height),e.stroke&&t.strokeRect(e.x,e.y,e.width,e.height)),t.restore()}},{key:"_updatePosition",value:function(t,e){this._cfg.style.x=t,this._cfg.style.y=e}},{key:"_updateSize",value:function(t,e){this._cfg.style.width=t,this._cfg.style.height=e}},{key:"getPoints",value:function(t){var e=t.x,n=t.y,i=t.borderRadius,r=t.width,o=t.height,a=a=[{x:e+i,y:n},{x:e+r,y:n},{x:e+r,y:n+o},{x:e,y:n+o},{x:e,y:n}];return a}},{key:"getDefaultCfg",value:function(){return{x:0,y:0,size:[]}}},{key:"getShapeStyle",value:function(){var t=this._cfg,e=t.size;m.a.isArray(t.size)?this._updateSize(e[0],e[1]):this._updateSize(e,e),this._updatePosition(t.x-t.style.width/2,t.y-t.style.height/2);var n={};return m.a.extend(n,this.getDefaultStyle(),t.style),n}},{key:"getDefaultStyle",value:function(){return{z:0,width:0,height:0,color:"#000",stroke:!1,lineWidth:1,lineDash:null}}}])&&p(n.prototype,i),r&&p(n,r),e}(),line:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,k(e).call(this,t))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(e,l),n=e,(i=[{key:"draw",value:function(t){this._draw(t)}},{key:"_draw",value:function(n){if(!n)throw new Error("illegal context");var i=this.get("style"),r=this.get("points");n.save(),i.lineDash&&n.setLineDash(i.lineDash),n.strokeStyle=i.stroke,n.lineWidth=i.lineWidth,n.lineJoin=i.lineJoin,n.lineCap=i.lineCap,n.beginPath(),m.a.each(r,function(t,e){0===e?n.moveTo(t.x,t.y):e===r.length-1&&i.arrow?v(n,[r[r.length-2],t],i):n.lineTo(t.x,t.y)}),n.stroke(),n.restore()}},{key:"updatePoints",value:function(t){this.set("points",t)}},{key:"getDefaultStyle",value:function(){return{stroke:"#000",lineWidth:2,lineJoin:"miter",lineCap:"butt"}}},{key:"getShapeStyle",value:function(){return m.a.mix({},this.getDefaultStyle(),this._cfg.style)}},{key:"getDefaultCfg",value:function(){return{points:[]}}}])&&x(n.prototype,i),r&&x(n,r),e}(),polyline:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),E(this,j(e).call(this,t))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(e,l),n=e,(i=[{key:"draw",value:function(t){this._draw(t)}},{key:"_draw",value:function(t){if(!t)throw new Error("illegal context");var e,n=this.get("style"),i=this.get("points");t.save(),t.strokeStyle=n.stroke,t.lineWidth=n.lineWidth,t.lineJoin=n.lineJoin,t.lineCap=n.lineCap,t.beginPath(),n.arrow&&(e=i.slice(-2),i=i.slice(0,-1)),S(t,i),t.stroke(),t.restore(),n.arrow&&v(t,e,{lineWidth:2,color:n.stroke})}},{key:"updatePoints",value:function(t){this.set("points",t)}},{key:"getDefaultStyle",value:function(){return{stroke:"#000",lineWidth:2,lineJoin:"miter",lineCap:"butt"}}},{key:"getShapeStyle",value:function(){var t=m.a.mix({},this.getDefaultStyle(),this._cfg.style);return t.arrow=this.get("arrow"),t}},{key:"getDefaultCfg",value:function(){return{x:0,y:0,points:[],anchors:[]}}}])&&O(n.prototype,i),r&&O(n,r),e}(),circle:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),z(this,I(e).call(this,t))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(e,l),n=e,(i=[{key:"draw",value:function(t){var e=this.getShapeStyle();this._draw(t,e)}},{key:"_draw",value:function(t,e){if(!t)throw new Error("illegal context");t.save(),t.lineWidth=e.lineWidth,t.strokeStyle=e.stroke,t.fillStyle=e.fill,t.beginPath(),t.arc(e.x,e.y,e.r,0,2*Math.PI),e.fill&&t.fill(),e.stroke&&t.stroke(),t.restore()}},{key:"changePosition",value:function(t,e){this._cfg.style.x=t,this._cfg.style.y=e}},{key:"changeSize",value:function(t){this._cfg.style.r=t}},{key:"getShapeStyle",value:function(){var t=this._cfg,e=t.size;m.a.isArray(t.size)?this.changeSize(e[0],e[1]):this.changeSize(e,e),this.changePosition(t.x,t.y);var n={};return m.a.extend(n,this.getDefaultStyle(),t.style),n}},{key:"getDefaultStyle",value:function(){return{z:0,width:0,height:0,color:"#000",stroke:!1,lineWidth:1}}},{key:"getDefaultCfg",value:function(){return{x:0,y:0}}}])&&D(n.prototype,i),r&&D(n,r),e}(),text:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),B(this,X(e).call(this,t))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(e,l),n=e,(i=[{key:"draw",value:function(t){this._draw(t,this._cfg)}},{key:"_draw",value:function(t,e){if(!t)throw new Error("illegal context");var n=this.get("style");t.save(),t.textBaseline=n.baseline,t.fillStyle=n.color,t.textAlign=n.align,t.font=n.weight+" "+n.size+" "+n.family,t.shadowBlur=n.shadowBlur,t.shadowColor=n.shadowColor,t.shadowOffsetX=n.shadowOffsetX,t.shadowOffsetY=n.shadowOffsetY,n.stroke?t.strokeText(e.content,e.x,e.y):t.fillText(e.content,e.x,e.y),t.restore()}},{key:"getDefaultCfg",value:function(){return{x:0,y:0,content:""}}},{key:"getShapeStyle",value:function(){var t=m.a.mix({},this.getDefaultStyle(),this.get("style"));return this._cfg.size&&(t.size=this._cfg.size+"px"),t}},{key:"getDefaultStyle",value:function(){return{baseline:"middle",color:"#000",size:"11px",weight:"normal",family:"黑体",align:"center",shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,stroke:!1}}}])&&L(n.prototype,i),r&&L(n,r),e}(),diamond:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),N(this,H(e).call(this,t))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(e,l),n=e,(i=[{key:"draw",value:function(t){var e=this.getPoints(this.get("style"));this._draw(t,e)}},{key:"_draw",value:function(t,e){if(!t)throw new Error("illegal context");var n=this.get("style");t.save(),t.fillStyle=n.fill,t.lineWidth=n.lineWidth,t.strokeStyle=n.stroke,t.beginPath(),n.borderRadius?h(t,e,n.borderRadius):S(t,e,n),t.closePath(),n.fill&&t.fill(),n.stroke&&t.stroke(),t.restore()}},{key:"changePosition",value:function(t,e){this._cfg.style.x=t,this._cfg.style.y=e}},{key:"changeSize",value:function(t,e){this._cfg.style.width=t,this._cfg.style.height=e}},{key:"getPoints",value:function(t){var e=Math.PI;return[{x:t.x-t.width/2+Math.cos(.25*e)*t.borderRadius,y:t.y-Math.cos(.25*e)*t.borderRadius},{x:t.x,y:t.y-t.height/2},{x:t.x+t.width/2,y:t.y},{x:t.x,y:t.y+t.height/2},{x:t.x-t.width/2,y:t.y}]}},{key:"getShapeStyle",value:function(){var t=this._cfg,e=t.size;m.a.isArray(t.size)?this.changeSize(e[0],e[1]):this.changeSize(e,e),this.changePosition(t.x,t.y);var n={};return m.a.extend(n,this.getDefaultStyle(),t.style),n}},{key:"getDefaultStyle",value:function(){return{z:0,width:0,height:0,color:"#000",stroke:!1,lineWidth:1}}},{key:"getDefaultCfg",value:function(){return{x:0,y:0}}}])&&W(n.prototype,i),r&&W(n,r),e}()},$=function(t){var e=K[t.type];if(!e)throw new Error("shape ".concat(t.type," is not exsit"));return new e(t)};function q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var V=function(){function n(t){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.children=[],this._cfg={},t&&t.type){var e=$(t);this._cfg.shape=e,t.layer&&t.layer.addLayer(this)}}var t,e,i;return t=n,(e=[{key:"_init",value:function(){}},{key:"draw",value:function(t){t.save(),this._drawLayer(t),this._draw(t),t.restore()}},{key:"_drawLayer",value:function(t){var e=this.get("shape");e&&e.draw(t)}},{key:"_draw",value:function(e){m.a.each(this.children,function(t){!t.get("hidden")&&t.draw(e)})}},{key:"add",value:function(t){(t.parent=this).children.push(t)}},{key:"remove",value:function(t){var e=this.children.indexOf(t);this.children.splice(e,1)}},{key:"update",value:function(t){var e=this.get("shape");e._cfg=m.a.deepMix(e._cfg,t),e.set("style",e.getShapeStyle())}},{key:"addLayer",value:function(t){return(t.parent=this).add(t),t}},{key:"addShape",value:function(t){var e=$(t);return(e.parent=this).add(e),e}},{key:"clear",value:function(){this.children=[]}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}}])&&q(t.prototype,e),i&&q(t,i),n}();function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Q(t,e){return!e||"object"!==J(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Z(t,e){return(Z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var tt=function(t){function n(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);return(e=Q(this,U(n).call(this)))._cfg=m.a.deepMix({width:1e3,height:500,ratio:1,matrix:[1,0,0,0,1,0,0,0,1],translateX:0,translateY:0},t),e.init(),e}var e,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Z(t,e)}(n,V),e=n,(i=[{key:"init",value:function(){this._init()}},{key:"_init",value:function(){var t=this._cfg;if(!m.a.isString(t.canvasId))throw new Error("canvas id must be string");var e=document.getElementById(t.canvasId);if(!e)return console.error("canvas is not exsit, please check the canvas id"),!1;var n=e.getContext("2d");this.set("canvas",e),this.set("context",n),this.changeSize(t.width,t.height)}},{key:"changeSize",value:function(t,e){this._cfg.width=t,this._cfg.height=e,this._changeSize(this._cfg.width,this._cfg.height)}},{key:"_changeSize",value:function(t,e){var n=this.get("canvas"),i=this.get("ratio");n.width=t*i,n.height=e*i,n.style.position="relative",n.style.zIndex="9998",n.style.width=t+"px",n.style.height=e+"px"}},{key:"draw",value:function(){var t=this.get("context");if(!t)throw new Error("context is not available");this.clean(this.get("width"),this.get("height"));var e=this.get("ratio"),n=this.get("matrix");t.save(),t.translate(n[6]*e,n[7]*e),t.scale(n[0]*e,n[4]*e),this._draw(t),t.restore(),t.save()}},{key:"clean",value:function(t,e){var n=this.get("context"),i=this.get("ratio");n.clearRect(0,0,t*i,e*i)}},{key:"clear",value:function(){this.children=[],this.clean()}},{key:"destory",value:function(){this.clear()}},{key:"scale",value:function(t){var e=this.get("matrix");e[0]=t,e[4]=t}},{key:"translate",value:function(t,e){var n=this.get("matrix");n[6]=t,n[7]=e}},{key:"getBox",value:function(){var t=this.get("canvas").getBoundingClientRect();return{l:t.left,t:t.top,r:t.right,b:t.bottom,width:t.width,height:t.height}}},{key:"getMatrix",value:function(){return this.get("matrix")}},{key:"on",value:function(t,e){this.get("canvas").addEventListener(t,e)}}])&&G(e.prototype,i),r&&G(e,r),n}(),et={rect:function(t,e){var n=t.size,i=0,r=0,o=t.x,a=t.y;r=m.a.isArray(n)?(i=n[0],n[1]):i=n;var s=i/2,u=r/2;return{x:o,y:a,t:a-u,l:o-s,b:a+u,r:o+s,width:i,height:r}},circle:function(t){var e=t.size,n=2*e,i=2*e,r=t.x,o=t.y,a=n/2,s=i/2;return{x:r,y:o,t:o-s,l:r-a,b:o+s,r:r+a,width:n,height:i}},diamond:function(t){return this.rect(t)}},nt=function(t){return t.type||console.error("shape.type属性不存在",t),et[t.type]?et[t.type](t.outlineCfg||t):{}},it=n(1),rt=n.n(it),ot={box:function(t,e,n,i,r){var o=r/2,a=Math.min(t,n),s=Math.max(t,n);return{minX:a-o,minY:Math.min(e,i)-o,maxX:s+o,maxY:Math.max(e,i)+o}},pointDistance:function(t,e,n,i,r,o){var a=[n-t,i-e];if(rt.a.exactEquals(a,[0,0]))return NaN;var s=[-a[1],a[0]];rt.a.normalize(s,s);var u=[r-t,o-e];return Math.abs(rt.a.dot(u,s))}},at=function(t,e,n,i){var r=1-i;return r*(r*t+2*i*e)+i*i*n},st=function(t,e,n,i,r,o,a,s,u){var c,l,h,f,p,g,y,d=.005,v=1/0,b=[a,s];for(p=0;p<1;p+=.05)h=[at(t,n,r,p),at(e,i,o,p)],(l=rt.a.squaredDistance(b,h))<v&&(c=p,v=l);for(v=1/0,y=0;y<32&&!(d<1e-4);y++){var m=c-d,x=c+d;h=[at(t,n,r,m),at(e,i,o,m)],l=rt.a.squaredDistance(b,h),0<=m&&l<v?(c=m,v=l):(f=[at(t,n,r,x),at(e,i,o,x)],g=rt.a.squaredDistance(b,f),x<=1&&g<v?(c=x,v=g):d*=.5)}return u&&(u.x=at(t,n,r,c),u.y=at(e,i,o,c)),Math.sqrt(v)},ut=function(t,e,n,i,r){var o=1-r;return o*o*(o*i+3*r*n)+r*r*(r*t+3*o*e)},ct=function(t,e,n,i,r,o,a,s,u,c,l){var h,f,p,g,y,d,v,b,m=.005,x=1/0,w=[u,c];for(f=0;f<1;f+=.05)p=[ut(t,n,r,a,f),ut(e,i,o,s,f)],(g=rt.a.squaredDistance(w,p))<x&&(h=f,x=g);x=1/0;for(var k=0;k<32&&!(m<1e-4);k++)b=h+m,p=[ut(t,n,r,a,v=h-m),ut(e,i,o,s,v)],g=rt.a.squaredDistance(w,p),0<=v&&g<x?(h=v,x=g):(d=[ut(t,n,r,a,b),ut(e,i,o,s,b)],y=rt.a.squaredDistance(w,d),b<=1&&y<x?(h=b,x=y):m*=.5);return l&&(l.x=ut(t,n,r,a,h),l.y=ut(e,i,o,s,h)),Math.sqrt(x)},lt=function(t,e,n,i){var r,o;return i?t<e?(r=e-t,o=2*Math.PI-n+t):n<t&&(r=2*Math.PI-t+e,o=t-n):(r=t-e,o=n-t),o<r?n:e},ht=function(t,e,n,i,r,o,a,s,u){var c,l,h,f,p,g=[a,s],y=[t,e],d=rt.a.subtract([],g,y),v=rt.a.angleTo([1,0],d);c=v,f=o,p=0,(h=r)-(l=i)>=2*Math.PI&&(p=2*Math.PI),l=m.a.mod(l,2*Math.PI),h=m.a.mod(h,2*Math.PI)+p,c=m.a.mod(c,2*Math.PI),v=f?h<=l?h<c&&c<l?c:lt(c,h,l,!0):c<l||h<c?c:lt(c,l,h):l<=h?l<c&&c<h?c:lt(c,l,h,!0):l<c||c<h?c:lt(c,h,l);var b=[n*Math.cos(v)+t,n*Math.sin(v)+e];return u&&(u.x=b[0],u.y=b[1]),rt.a.distance(b,g)},ft={line:function(t,e,n,i,r,o,a){var s=ot.box(t,e,n,i,r);if(!this.box(s.minX,s.maxX,s.minY,s.maxY,o,a))return!1;var u=ot.pointDistance(t,e,n,i,o,a);return!isNaN(u)&&u<=r/2},polyline:function(t,e,n,i){var r=t.length-1;if(r<1)return!1;for(var o=0;o<r;o++){var a=t[o].x,s=t[o].y,u=t[o+1].x,c=t[o+1].y;if(this.line(a,s,u,c,e,n,i))return!0}return!1},cubicline:function(t,e,n,i,r,o,a,s,u,c,l){return ct(t,e,n,i,r,o,a,s,c,l)<=u/2},quadraticline:function(t,e,n,i,r,o,a,s,u){return st(t,e,n,i,r,o,s,u)<=a/2},arcline:function(t,e,n,i,r,o,a,s,u){return ht(t,e,n,i,r,o,s,u)<=a/2},rect:function(t,e,n,i,r,o){return t<=r&&r<=t+n&&e<=o&&o<=e+i},circle:function(t,e,n,i,r){return Math.pow(i-t,2)+Math.pow(r-e,2)<=Math.pow(n,2)},box:function(t,e,n,i,r,o){return t<=r&&r<=e&&n<=o&&o<=i}},pt={box:function(t,e){var n=t.get("box");return ft.box(n.l,n.r,n.t,n.b,e.x,e.y)},rect:function(t,e){var n=t.get("box");return ft.rect(n.l,n.t,n.width,n.height,e.x,e.y)},circle:function(t,e){var n=t.get("box");return ft.circle(n.x,n.y,n.width/2,e.x,e.y)},polyline:function(t,e){var n=t.get("shape");return ft.polyline(n.points,n.style.lineWidth+6,e.x,e.y)}},gt=function(t){var e=t.get("shape").type;if(!e)return!1;var n=pt[e]||pt.box,i=[].slice.call(arguments);return n.apply(this,i)};function yt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var dt=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t)}var t,n,i;return t=e,(n=[{key:"init",value:function(t){this._cfg=m.a.deepMix(this.getDefaultCfg(),t),this._init()}},{key:"_init",value:function(){var t=this.get("graph"),e=m.a.mix(this.getDefaultShapeCfg(),this.getShapeCfg());e.hidden=this.get("hidden"),t.addShape(e),this.getBox()}},{key:"on",value:function(t,e,n){var i=this.get("graph"),r=i.get("eventMap"),o=i.get("eventItemMap"),a={item:this,callback:e,option:n,children:[]};r[t]?r[t].push(a):r[t]=[a];var s=this.get("id");o[s]||(o[s]={}),o[s][t]=a}},{key:"emit",value:function(t){var e=this.get("graph").get("eventItemMap")[this.get("id")];if(!e)return!1;var n=e[t];if(!n)return!1;var i=n.callback,r=[].slice.call(arguments,1);i.apply(this,r)}},{key:"update",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this._cfg.x,n=this._cfg.y,i=this.getShapeCfg();m.a.mix(i,t),this._isOnlyMove(t)?this.updatePosition(i):(e===i.x&&n===i.y||this.updatePosition(i),(t.width||t.height||t.r||t.size)&&this.updateSize(i),this.updateShape()),this.get("graph").autoPaint()}},{key:"updatePosition",value:function(t){var e=this.get("graph");this._cfg.x=t.x,this._cfg.y=t.y;var n=e.get("shapeMap")[this.get("id")];(n.get("shape")?n.get("shape"):n).update({x:t.x,y:t.y})}},{key:"updateSize",value:function(t){t.width||t.height?m.a.isArray.shape.size?(t.size[0]=t.width,t.size[1]=t.height):t.width?t.size=t.width:t.height&&(t.size=t.height):t.r&&(t.size=t.r)}},{key:"updateShape",value:function(){var t=this.get("shape");this.getShape().update(t),this.get("graph").autoPaint()}},{key:"changeLabel",value:function(t){var e=this.get("graph"),n=this.get("labelId");e.get("shapeMap")[n].update({content:t}),e.autoPaint()}},{key:"getShapeCfg",value:function(){return this._getShapeCfg()}},{key:"_getShapeCfg",value:function(){var t=this.get("shape");return m.a.mix(t,{x:this._cfg.x,y:this._cfg.y}),t}},{key:"getBox",value:function(){var t=this.get("shape"),e=nt(t);return this.set("box",e),e}},{key:"_isOnlyMove",value:function(t){if(!t)return!1;var e=!m.a.isNil(t.x),n=!m.a.isNil(t.y),i=Object.keys(t);return 1===i.length&&(e||n)||2===i.length&&e&&n}},{key:"isPointIn",value:function(t){return gt(this,t)}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}},{key:"setState",value:function(t,e){var n=this,i=this.get("state"),r=this.get("graph");i[t]=e;var o=this.get("stateShapeMap");if(o){var a=m.a.deepMix(this.getDefaultShapeCfg(),o.default);m.a.each(i,function(t,e){t&&m.a.deepMix(a,o[e])});var s=a.style;if(s.transition)m.a.each(s.transition.property,function(t){r.$animate.add(m.a.mix({},s.transition,{shape:n.getShape(),property:t,value:"size"===t?a.size:s[t]}))});else if(a){var u=this.get("shape");m.a.deepMix(u,a),this.updateShape()}}this.emit("stateChange",t,e,i)}},{key:"show",value:function(){var t=this.get("graph");this.set("hidden",!1),this.getShape().update({hidden:!1}),t.paint()}},{key:"hide",value:function(){var t=this.get("graph");this.set("hidden",!0),this.getShape().update({hidden:!0}),t.paint()}},{key:"getShape",value:function(){return this.get("graph").get("shapeMap")[this.get("id")]}},{key:"getDefaultCfg",value:function(){return m.a.mix({state:{},box:{},parent:"",shape:{},alwaysShow:!0},this._getDefaultCfg())}},{key:"_getDefaultCfg",value:function(){return{}}},{key:"getDefaultShapeCfg",value:function(){var t=this.get("graph"),e=this.get("parent"),n=t.get("shapeMap")[e];return{id:this.get("id"),parent:n}}},{key:"hasParent",value:function(t){for(var e=this.get("graph"),n=this.get("parent"),i=!1;n;){if(n===t){i=!0;break}n=e.findById(n).get("parent")}return i}}])&&yt(t.prototype,n),i&&yt(t,i),e}();function vt(t){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function mt(t,e){return!e||"object"!==vt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function xt(t,e,n){return(xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wt(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function wt(t){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kt(t,e){return(kt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _t=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=t[0],n=t[1];return e===n&&0===e?"corner":0===e?"left":1===e?"right":0===n?"top":1===n&&"bottom"},St=function(t,e){var n=t.x,i=t.y;return"left"===e?n-=30:"top"===e?i-=30:"right"===e?n+=30:"bottom"===e&&(i+=30),{x:n,y:i}};function Pt(t){return(Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Et(t,e){return!e||"object"!==Pt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mt(t,e){return(Mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zt(t,e){return!e||"object"!==Ct(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function It(t,e,n){return(It="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Tt(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Tt(t){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function At(t,e){return(At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Lt={base:dt,node:function(t){function u(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);return mt(this,wt(u).call(this,m.a.mix(t,{state:{},children:[],anchors:{}})))}var e,n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kt(t,e)}(u,dt),e=u,(n=[{key:"_init",value:function(){var t=this.get("graph"),e=t.get("nodeLayer"),n=this.getShapeCfg(),i=e.addLayer(new V(n));i.parent=e,t.get("shapeMap")[this.get("id")]=i,this.getBox(),this.addLabel()}},{key:"addEdge",value:function(t,e){this.get("".concat(t,"Edges")).push(e)}},{key:"removeEdge",value:function(t,e){var n=this.get("".concat(t,"Edges")),i=n.indexOf(e);n.splice(i,1)}},{key:"addLabel",value:function(){var t=this.get("graph"),e=this.get("label"),n=t.get("shapeMap"),i=m.a.mix({offsetX:0,offsetY:0},this.get("labelCfg"));i.type="text",i.content=e,i.x=this._cfg.x+i.offsetX,i.y=this._cfg.y+i.offsetY,this.set("labelCfg",i);var r=t.addShape(m.a.mix({},i,{parent:n[this.get("id")]}));this.set("labelId",r)}},{key:"setState",value:function(t,e){xt(wt(u.prototype),"setState",this).call(this,t,e),this.handleStateChange(t)}},{key:"handleStateChange",value:function(t){var e=this.get("graph");e.get("shapeMap"),this.get("state");e.paint()}},{key:"updatePosition",value:function(t){xt(wt(u.prototype),"updatePosition",this).call(this,t);var e=this.get("graph"),n=e.get("shapeMap");this.getBox();var i=this.get("outEdges");m.a.each(i,function(t){e.findById(t).updatePath()});var r=this.get("inEdges");m.a.each(r,function(t){e.findById(t).updatePath()});var o=this.get("labelId");if(o){var a=n[o];if(a){var s=this.get("labelCfg");a.update({x:t.x+s.offsetX,y:t.y+s.offsetY})}}}},{key:"getData",value:function(){return m.a.pick(this._cfg,["id","x","y","state","outEdges","inEdges","props","label","cfgKey"])}},{key:"getAnchorPoint",value:function(t){var e=this.get("box");return{x:e.l+e.width*t[0],y:e.t+e.height*t[1],m:t}}},{key:"_getDefaultCfg",value:function(){return{x:0,y:0,box:{},parent:"",label:"",anchorMatrix:[],outEdges:[],inEdges:[],labelCfg:{offsetX:0,offsetY:0}}}}])&&bt(e.prototype,n),i&&bt(e,i),u}(),edge:function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Et(this,jt(e).call(this,t))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mt(t,e)}(e,dt),n=e,(i=[{key:"_init",value:function(){var t=this.get("graph"),e=t.get("edgeLayer"),n=this.getShapeCfg(),i=e.addLayer(new V(n));i.parent=e,t.get("shapeMap")[this.get("id")]=i,this.addLabel()}},{key:"addLabel",value:function(){var t=this.get("graph"),e=this.get("label"),n=t.get("shapeMap"),i=m.a.mix({offsetX:0,offsetY:0,style:{}},this.get("labelCfg"));i.type="text",i.content=e;var r=this.getLabelPosition();i.x=r.x+i.offsetX,i.y=r.y+i.offsetY;var o=this.get("points"),a=this.get("arrow")?o.slice(-3,-1):o.slice(-2),s=this.getLineDirection(a);i.style.align="H"===s?"right":"center",this.set("labelCfg",i);var u=t.addShape(m.a.mix({},i,{parent:n[this.get("id")]}));this.set("labelId",u)}},{key:"getLabelPosition",value:function(){var t=this.get("points");return(this.get("arrow")?t.slice(-3,-2):t.slice(-1))[0]}},{key:"updateLabelPosition",value:function(){var t=this.get("points"),e=this.get("arrow")?t.slice(-3,-1):t.slice(-2),n=this.getLineDirection(e),i=this.get("graph").get("shapeMap")[this.get("labelId")],r=this.getLabelPosition();i.update({x:r.x,y:r.y,style:{align:"H"===n?"right":"center"}})}},{key:"_getShapeCfg",value:function(){var t=this.get("shape"),e=this._getPoints();return t.arrow=this.get("arrow"),t.points=e,t}},{key:"_getPoints",value:function(){var t=this.get("graph"),e=this.get("shape"),n=t.findById(this.get("source"));if(!n)return console.error("未找到".concat(this.get("source"),"对应节点")),[];var i=this.get("startAnchor"),r=n.getAnchorPoint(i);this.set("startPoint",r);var o=t.findById(this.get("target")),a=o&&this.get("endAnchor"),s=o?o.getAnchorPoint(a):e.endPoint;this.set("endPoint",s);var u=function(t,e,n,i,r){var o=n.x,a=n.y,s=i.x,u=i.y,c=[{x:o,y:a}],l=_t(t),h=_t(e),f=St(n,l);o=f.x,a=f.y;var p=St(i,h);s=p.x,u=p.y;var g,y,d,v,b,m,x,w,k,_,S=(y=p,d=(g=f).x,v=g.y,b=y.x,m=y.y,d<b&&m<v?1:b<d&&m<v?2:b<d&&v<m?3:d<b&&v<m?4:void 0);if(c.push(f),!h){var P=Math.abs(o-s),O=Math.abs(a-u);"top"===l||"bottom"===l?1===S?O<P?(c.push({x:o,y:a-O/2}),c.push({x:s,y:a-O/2})):c.push({x:o,y:u}):2===S?O<P?(c.push({x:o,y:a-O/2}),c.push({x:s,y:a-O/2})):c.push({x:o,y:u}):3===S?O<P?(c.push({x:o,y:a+O/2}),c.push({x:s,y:a+O/2})):c.push({x:o,y:u}):4===S&&(O<P?(c.push({x:o,y:a+O/2}),c.push({x:s,y:a+O/2})):c.push({x:o,y:u})):"left"!==l&&"right"!==l||(1===S?P<O?(c.push({x:o+P/2,y:a}),c.push({x:o+P/2,y:u})):c.push({x:s,y:a}):2===S?P<O?(c.push({x:o-P/2,y:a}),c.push({x:o-P/2,y:u})):c.push({x:s,y:a}):3===S?P<O?(c.push({x:o-P/2,y:a}),c.push({x:o-P/2,y:u})):c.push({x:s,y:a}):4===S&&(P<O?(c.push({x:o+P/2,y:a}),c.push({x:o+P/2,y:u})):c.push({x:s,y:a})))}return"left"===l?1===S?"left"===h?c.push({x:o,y:u}):"top"===h?c.push({x:o,y:u}):"right"===h?(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):"bottom"===h&&c.push({x:o,y:u}):2===S?"left"===h?c.push({x:s,y:a}):"top"===h?c.push({x:o,y:u}):"right"===h?(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u})):"bottom"===h&&c.push({x:s,y:a}):3===S?"left"===h?c.push({x:s,y:a}):"top"===h?c.push({x:s,y:a}):"right"===h?(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u})):"bottom"===h&&c.push({x:o,y:u}):4===S&&("left"===h?c.push({x:o,y:u}):"top"===h?c.push({x:o,y:u}):"right"===h?(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):"bottom"===h&&c.push({x:o,y:u})):"top"===l?1===S?"left"===h?c.push({x:o,y:u}):"top"===h?c.push({x:o,y:u}):"right"===h?c.push({x:s,y:a}):"bottom"===h&&(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):2===S?"left"===h?c.push({x:s,y:a}):"top"===h?c.push({x:o,y:u}):"right"===h?c.push({x:o,y:u}):"bottom"===h&&(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):3===S?"left"===h?c.push({x:s,y:a}):"top"===h?c.push({x:s,y:a}):"right"===h?c.push({x:s,y:a}):"bottom"===h&&(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u})):4===S&&("left"===h?c.push({x:s,y:a}):"top"===h?c.push({x:s,y:a}):"right"===h?c.push({x:s,y:a}):"bottom"===h&&(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u}))):"right"===l?1===S?"left"===h?(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u})):"top"===h?c.push({x:o,y:u}):"right"===h?c.push({x:s,y:a}):"bottom"===h&&c.push({x:s,y:a}):2===S?"left"===h?(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):"top"===h?c.push({x:o,y:u}):"right"===h?c.push({x:o,y:u}):"bottom"===h&&c.push({x:o,y:u}):3===S?"left"===h?(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):"top"===h?c.push({x:o,y:u}):"right"===h?c.push({x:o,y:u}):"bottom"===h&&c.push({x:o,y:u}):4===S&&("left"===h?(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u})):"top"===h?c.push({x:s,y:a}):"right"===h?c.push({x:s,y:a}):"bottom"===h&&c.push({x:o,y:u})):"bottom"===l&&(1===S?"left"===h?c.push({x:s,y:a}):"top"===h?(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u})):"right"===h?c.push({x:s,y:a}):"bottom"===h&&c.push({x:s,y:a}):2===S?"left"===h?c.push({x:s,y:a}):"top"===h?(c.push({x:s+(o-s)/2,y:a}),c.push({x:s+(o-s)/2,y:u})):"right"===h?c.push({x:s,y:a}):"bottom"===h&&c.push({x:s,y:a}):3===S?"left"===h?c.push({x:s,y:a}):"top"===h?(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):"right"===h?c.push({x:o,y:u}):"bottom"===h&&c.push({x:o,y:u}):4===S&&("left"===h?c.push({x:o,y:u}):"top"===h?(c.push({x:o,y:u+(a-u)/2}),c.push({x:s,y:u+(a-u)/2})):"right"===h?c.push({x:s,y:a}):"bottom"===h&&c.push({x:o,y:u}))),e&&p&&c.push(p),r&&c.push((x=c.slice(-1)[0],k=(w=i).x,_=w.y,x.y===w.y&&x.x<w.x?k-=10:x.x===w.x&&x.y<w.y?_-=10:x.y===w.y&&x.x>w.x?k+=10:x.x===w.x&&x.y>w.y&&(_+=10),{x:k,y:_})),c.push(i),c}(i,a,r,s,this.get("arrow"));return this.set("points",u),u}},{key:"getData",value:function(){return m.a.pick(this._cfg,["id","state","source","startAnchor","target","endAnchor","props","label","cfgKey"])}},{key:"getLineDirection",value:function(t){var e=t[0],n=t[1];return e.x===n.x?"V":"H"}},{key:"getPathPart",value:function(t){for(var e,n=this.get("shape").points,i=t.x,r=t.y,o=this.get("shape").style.lineWidth,a=1,s=n.length;a<s;a++){var u=n[a],c=n[a+1];if(!c)break;if(Math.abs(i-u.x)<=o&&Math.abs(i-c.x)<=o||Math.abs(r-u.y)<=o&&Math.abs(r-c.y)<=o){e=[u,c];break}}return e}},{key:"getMidPoint",value:function(t){var e=t[0],n=t[1],i=e.x,r=e.y;return e.x===n.x?r=(e.y-n.y)/2+n.y:e.y===n.y&&(i=(e.x-n.x)/2+n.x),{x:i,y:r}}},{key:"updatePath",value:function(){var t=this.get("shape"),e=this._getPoints();t.points=e,t.arrow=this.get("arrow"),this.updateShape(),this.updateLabelPosition()}},{key:"update",value:function(t){var e=this.getShapeCfg();m.a.mix(e,t),this.updateShape()}},{key:"_getDefaultCfg",value:function(){return{state:{},source:null,target:null,arrow:!1,startAnchor:[],endAnchor:[],points:[],shape:{startPoint:{},endPoint:{}},label:"",labelCfg:{},props:{}}}},{key:"getDefaultShapeCfg",value:function(){return{id:this.get("id")}}}])&&Ot(n.prototype,i),r&&Ot(n,r),e}(),anchor:function(t){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),zt(this,Tt(n).apply(this,arguments))}var e,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}(n,dt),e=n,(i=[{key:"_init",value:function(){var t=this.get("graph").findById(this.get("parent")),e=this.getPosition();t.get("anchors")[e]=this,It(Tt(n.prototype),"_init",this).call(this)}},{key:"isPointIn",value:function(t){var e=this.get("eventArea")||{},n=this.get("shape"),i=e.r||n.size;return this.pointDistance({x:this._cfg.x,y:this._cfg.y},t)<Math.pow(i,2)}},{key:"pointDistance",value:function(t,e){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}},{key:"_getShapeCfg",value:function(){It(Tt(n.prototype),"_getShapeCfg",this).call(this);var t=this.get("shape");return t.hidden=this.get("hidden"),t}},{key:"_getDefaultCfg",value:function(){return{state:{},hidden:!1,position:"",m:[],shape:{size:5,type:"circle",style:{lineWidth:2,stroke:"#CCC",fill:"#FFF"}},cancelBubble:!0}}},{key:"getPosition",value:function(){var t,e=this.get("m");return 0===e[0]?t="left":1===e[0]?t="right":0===e[1]?t="top":1===e[1]&&(t="bottom"),t}}])&&Dt(e.prototype,i),r&&Dt(e,r),n}()};function Bt(){for(var t=[],e="0123456789abcdef",n=0;n<16;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);return t[3]="4",t[7]=e.substr(3&t[7]|8,1),t.join("")}var Xt=function(i){var n,r={insert:function(t){var e=i.insert(t);return i.saveData(),e},copy:function(){var t=i.get("targetMap");if(1<t.focus.length)return!1;var e=t.focus[0];i.set("copiedItem",m.a.pick(e._cfg,["x","y","label","props","cfgKey"]))},paste:function(){i.get("configMap");var t=i.get("copiedItem");t.y+=50;var e=i.addItem("node",t);return i.set("copiedItem",t),i.saveData(),e},delete:function(){var t=i.get("targetMap"),e=t.focus;return m.a.each(e,function(t){i.removeItem(t)}),t.focus=[],i.saveData(),e},tofront:function(){var t=i.get("targetMap");if(1<t.focus.length)return!1;var e=t.focus;i.tofront(e),i.saveData()},toback:function(){var t=i.get("targetMap");if(1<t.focus.length)return!1;var e=t.focus;i.toback(e),i.saveData()},undo:function(){var t=i.$history.prevState();i.render(t)},redo:function(){var t=i.$history.nextState();i.render(t)},zoomin:function(){i.zoomin()},zoomout:function(){i.zoomout()},fitpage:function(){i.scale(1)},fitpagewidth:function(){var t=i.get("diagramWidth"),e=i.get("width");i.scale(e/t)},clear:function(){i.clear(),i.autoPaint()}};return n=i,window.addEventListener("keydown",function(t){if(!n.get("state").focus)return!1;var e=t.keyCode?t.keyCode:t.which?t.which:t.charCode;switch(window.event.shiftKey&&(e="shift+"+e),window.event.ctrlKey&&(e="ctrl+"+e),e){case 8:case 46:n.$trigger("delete");break;case"ctrl+67":n.$trigger("copy");break;case"ctrl+86":n.$trigger("paste");break;case"ctrl+90":n.$trigger("undo");break;case"ctrl+shift+90":n.$trigger("redo")}}),function(t){var e=Array.from(arguments).slice(1),n=r[t].apply(r,e);i.emit(t,n)}},Yt=function(){var e=[],n=-1;return{getStateId:function(){return n},getLength:function(){return e.length},saveState:function(t){t=JSON.stringify(t),-1<n&&(e=e.slice(0,n+1)),e.push(t),n++},clearStates:function(){e=[],n=-1},nextState:function(){return n=n+1<e.length-1?n+1:e.length-1,JSON.parse(e[n])},prevState:function(){return n=-1<n-1?n-1:0,JSON.parse(e[n])},currentState:function(){return JSON.parse(e[n])}}},Rt=n(2),Wt=n(3);function Nt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ht={downPoint:null,prevPoint:null,direction:"vertical",scroller:null,mousedown:function(t,e){Ht.direction=e,Ht.prevPoint={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",Ht.mousemove),document.addEventListener("mouseup",Ht.mouseup)},mousemove:function(t){t.preventDefault();var e=Ht.scroller;"vertical"===Ht.direction&&e.get("hasVer")?e.scrollVer(t.clientY-Ht.prevPoint.y):"horizontal"===Ht.direction&&e.get("hasHor")&&e.scrollHor(t.clientX-Ht.prevPoint.x),Ht.prevPoint={x:t.clientX,y:t.clientY}},mouseup:function(t){document.removeEventListener("mousemove",Ht.mousemove),document.removeEventListener("mouseup",Ht.mouseup)}},Ft=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);this._cfg=m.a.mix({},{container:null,vbar:null,hbar:null,width:1e3,height:500,scrollTop:0,scrollLeft:0,vbarSize:0,hbarSize:0,refs:{},graph:null,speed:20,barSize:10,originTranslateX:0,originTranslateY:0,translateX:0,translateY:0},t),this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){var e=this;this.buildLayout(),this.changeSize();var t=this.get("container"),n=this.get("speed");t.onWheel(function(t){t.preventDefault(),e.get("hasHor")&&e.scrollHor(t.deltaX*n),e.get("hasVer")&&e.scrollVer(t.deltaY*n)}),(Ht.scroller=this).get("vbar").on("mousedown",function(t){Ht.mousedown(t,"vertical")}),this.get("hbar").on("mousedown",function(t){Ht.mousedown(t,"horizontal")})}},{key:"reset",value:function(){this.set("scrollLeft",0),this.set("scrollTop",0)}},{key:"buildLayout",value:function(){var t={};Object(Rt.a)({tag:"div",ref:"scrollContainer",props:{className:"scroll-container"},children:[{tag:"div",props:{className:"scroll-vertical-container"},children:[{tag:"div",ref:"scrollVerBar",props:{className:"scroll-bar"}}]},{tag:"div",props:{className:"scroll-horizontal-container"},children:[{tag:"div",ref:"scrollHorBar",props:{className:"scroll-bar"}}]}]},t),this.set("scroller",t.scrollContainer),this.set("vbar",t.scrollVerBar),this.set("hbar",t.scrollHorBar),this.get("container").append(t.scrollContainer)}},{key:"changeSize",value:function(){var t=this.get("graph"),e=t.get("ratio"),n=this.get("barSize"),i=t.get("width"),r=t.get("height");this.set("width",i),this.set("height",r);var o=t.get("width"),a=t.get("height"),s=t.get("diagramWidth")*e,u=t.get("diagramHeight")*e,c=this.get("vbar"),l=this.get("hbar"),h=this.get("scroller"),f=a<u,p=o<s,g=a/u,y=o/s;if(this.set("hasVer",f),this.set("hasHor",p),this.set("vratio",g),this.set("hratio",y),this.reset(),h.css({width:i+n+"px",height:r+n+"px"}),p){var d=y*i;l.css({width:d+"px",display:"block"}),this.set("hbarSize",d);var v=this.get("originTranslateX")*e;this.scrollHor(-v)}else l.css({width:"0px",display:"none",transform:"translate(0,0)"}),this.scrollHor(0);if(f){var b=g*r;this.set("vbarSize",b),c.css({height:b+"px",display:"block"});var m=this.get("originTranslateY")*e;this.scrollVer(-m)}else c.css({height:"0px",display:"none",transform:"translate(0,0)"}),this.scrollVer(0)}},{key:"scroll",value:function(){this.get("graph").translate(this.get("translateX"),this.get("translateY"))}},{key:"scrollHor",value:function(t){var e=this.get("hbar"),n=this.get("hbarSize"),i=this.get("width"),r=this.get("hratio"),o=this.get("graph").get("ratio"),a=this.get("scrollLeft");(a+=t)<0?a=0:i<a+n&&(a=i-n);var s=-a/r||0;e.css("transform","translate("+a+"px,0)"),this.set("scrollLeft",a),this.set("translateX",s),this.set("originTranslateX",s/o),this.scroll()}},{key:"scrollVer",value:function(t){var e=this.get("vbar"),n=this.get("vbarSize"),i=this.get("height"),r=this.get("vratio"),o=this.get("graph").get("ratio"),a=this.get("scrollTop");(a+=t)<0?a=0:i<a+n&&(a=i-n);var s=-a/r||0;e.css("transform","translate(0,"+a+"px)"),this.set("scrollTop",a),this.set("translateY",s),this.set("originTranslateY",s/o),this.scroll()}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}}])&&Nt(t.prototype,n),i&&Nt(t,i),e}(),Kt=function(t,e){K[t]=e(l)};function $t(t){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Jt(t,e,n){return e&&Vt(t.prototype,e),n&&Vt(t,n),t}function Gt(t,e){return!e||"object"!==$t(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Qt(t){return(Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ut(t,e){return(Ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Kt("grid",function(n){return function(t){function e(){return qt(this,e),Gt(this,Qt(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ut(t,e)}(e,n),Jt(e,[{key:"draw",value:function(t){var e=this.get("style");this._draw(t,e)}},{key:"_draw",value:function(t,e){var n=this.get("width"),i=this.get("height"),r=this.get("size"),o=0,a=0;for(t.save(),t.beginPath();o<n;)t.moveTo(o,0),t.lineTo(o,i),o+=r;for(;a<i;)t.moveTo(0,a),t.lineTo(n,a),a+=r;t.strokeStyle=e.stroke,t.stroke(),t.restore()}},{key:"getShapeStyle",value:function(){return{lineWidth:1,stroke:"#eee"}}}]),e}()});var Zt=function(){function e(t){qt(this,e);this._cfg=m.a.mix({},{size:10},t),this.init()}return Jt(e,[{key:"init",value:function(){var t=this.get("graph"),e=t.get("diagramWidth"),n=t.get("diagramHeight");t.$grid=this;var i=t.addShape({type:"grid",width:e,height:n}),r=t.findShapeById(i);t.on("afterChangeDiagramSize",function(t,e){r.update({width:t,height:e})})}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}}]),e}(),te={linear:function(t,e,n,i){return t*(n/i)+e}};function ee(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ne=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);this._cfg=m.a.mix({},{queue:[]},t)}var t,n,i;return t=e,(n=[{key:"isExsit",value:function(t){var e=this.get("queue"),n=t.shape.get("id"),i=t.property;return m.a.find(e,function(t){return t.shape.get("id")===n&&t.p===i})}},{key:"add",value:function(t){var e=t.shape;if(!e)return!1;var n=t.property;if(!n)return!1;var i=this.isExsit(t);if(i)i.pasue=!0,this.update(i,t);else{var r=this.get("queue"),o=e.get("style"),a="size"===n?e.get("size"):o[n];r.push(m.a.mix({},this.getDefaultProp(),{shape:e,p:n,t:0,b:a||0,c:t.value-a||0,d:t.duration||1e3}))}this.get("running")||this.runQueue()}},{key:"update",value:function(t,e){var n=e.property,i=e.shape,r=i.get("style"),o="size"===n?i.get("size"):r[n];t.t=0,t.b=o||0,t.c=e.value-o||0,t.d=e.duration||1e3}},{key:"remove",value:function(t){var e=this.get("queue"),n=e.indexOf(t);e.splice(n,1)}},{key:"runQueue",value:function(){var e=this,t=this.get("graph"),n=this.get("queue"),i=setInterval(function(){if(t.paint(),!n.length)return clearInterval(i),e.set("running",!1),!1;m.a.each(n,function(t){t&&!t.pause&&e.run(t)}),n=m.a.filter(n,function(t){return!t.pause}),e.set("queue",n)},1e3/60);this.set("running",!0)}},{key:"run",value:function(t){if(!t)return!1;var e=t.shape;if(!e)return!1;var n={},i=t.t+1e3/60,r=t.d;n[t.p]=te[t.timingFunction](t.t,t.b,t.c,t.d),e.update(n),r<=(t.t=i)&&(t.pause=!0)}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}},{key:"getDefaultProp",value:function(){return{timingFunction:"linear",delay:0,duration:1e3}}}])&&ee(t.prototype,n),i&&ee(t,i),e}();function ie(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var re=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);this._cfg=m.a.mix({},{graph:null,rbbd:null},t),this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.addEvent()}},{key:"addEvent",value:function(){var c=this,l=this.get("graph"),h=null,f=null,s=null,p=function(t){var e=h.x,n=h.y,i=t.clientX,r=t.clientY;!f&&(15<Math.abs(h.x-i)||15<Math.abs(h.y-r))&&(f=c.createRubberband({x:e-s.l,y:n-s.t}));var o=i-h.x,a=r-h.y;f&&f.css({transform:"translate("+(o<0?o:0)+"px,"+(a<0?a:0)+"px)",width:Math.abs(o)+"px",height:Math.abs(a)+"px"})},e=function t(e){if(f){f.remove(),f=null;var n=h.x,i=h.y,r=e.clientX,o=e.clientY,a=l.getPointByClient(n,i),s=l.getPointByClient(r,o),u={l:0,t:0,r:0,b:0};u.r=r<n?(u.l=s.x,a.x):(u.l=a.x,s.x),u.b=r<n?(u.t=s.y,a.y):(u.t=a.y,s.y),c.selectArea(u)}document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",t)};l.on("mousedown",function(t){if(t.target)return!1;t=t.origin,s=l.getBox(),h={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",p),document.addEventListener("mouseup",e)})}},{key:"createRubberband",value:function(t){var e=this.get("graph").get("container"),n=Object(Rt.a)({tag:"div",props:{className:"kg-rubber-band"},style:{position:"absolute",left:t.x+"px",top:t.y+"px",border:"1px solid rgb(179, 179, 245)",background:"rgba(179, 179, 245, 0.1)",zIndex:"9999"}});return e.append(n),this.set("rbbd",n),n}},{key:"selectArea",value:function(i){var t=this.get("graph"),e=t.get("nodes"),r=(t.get("edges"),t.get("targetMap"));r.focus=[],m.a.each(e,function(t){var e=t.get("x"),n=t.get("y");e>i.l&&e<i.r&&n>i.t&&n<i.b&&(t.setState("focus",!0),r.focus.push(t))})}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}}])&&ie(t.prototype,n),i&&ie(t,i),e}();function oe(t){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ae(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function se(t,e){return!e||"object"!==oe(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ue(t){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ce(t,e){return(ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var le={Graph:function(t){function n(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);if((e=se(this,ue(n).call(this)))._cfg=m.a.deepMix({canvasId:"",container:null,width:1e3,height:500,diagramWidth:800,diagramHeight:400,ratio:1,maxRatio:2,minRatio:.2,nodes:[],edges:[],itemMap:{},shapeMap:{},configMap:{},data:{nodes:[],edges:[]},eventMap:{},eventItemMap:{},targetMap:{mouseenter:[],focus:[],mouseleave:null,mouseup:null,click:null},state:{},nodeLayer:null,translateX:0,translateY:0,fitcanvas:!0,enableScroll:!0,enableGrid:!1,enableRubberband:!0,bgColor:"#FFF",gridAlign:!1,originRatio:1,autoPaint:!0,autoExpandDiagram:!0,limitX:100,limitY:100},t),m.a.isString(t.container)&&(e._cfg.container=Object(Wt.a)("."+t.container),!e._cfg.container))throw new Error(t.container+"不存在");return e._cfg.container.css({width:e._cfg.width+"px",height:e._cfg.height+"px"}),e._cfg.enableScroll&&(e._cfg.width=e._cfg.width-10,e._cfg.height=e._cfg.height-10),e._init(),e}var e,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ce(t,e)}(n,u),e=n,(i=[{key:"_init",value:function(){this._changeDiagramSize(),this._initCanvas(),this._initBackground(),this._initGrid(),this._initGroups(),this._initEvent(),this.$trigger=new Xt(this),this.$history=new Yt,this.get("enableRubberband")&&(this.$rubberband=new re({graph:this})),this.$scroller=new Ft({container:this.get("container"),graph:this,width:this.get("width"),height:this.get("height")}),this.$animate=new ne({graph:this}),this.saveData()}},{key:"_initEvent",value:function(){var e=new a(this);this.handleEvent=function(){var t=[].slice.call(arguments);e._handleEvents.apply(e,t)}}},{key:"_initCanvas",value:function(){var t=m.a.pick(this._cfg,["width","height","canvasId"]);t.ratio=this.get("originRatio"),this.set("canvas",new tt(t))}},{key:"_initBackground",value:function(){var t=this.get("canvas"),e=this.get("diagramWidth"),n=this.get("diagramHeight"),i=this.get("bgColor"),r=new V({type:"rect",x:e/2,y:n/2,size:[e,n],style:{fill:i}});t.addLayer(r),this.set("background",r)}},{key:"_updateBackground",value:function(){this.get("canvas");var t=this.get("background").get("shape"),e=this.get("diagramWidth"),n=this.get("diagramHeight");t.update({x:e/2,y:n/2,size:[e,n]})}},{key:"_initGrid",value:function(){if(!this.get("enableGrid"))return!1;this.$grid=new Zt({graph:this})}},{key:"_initGroups",value:function(){var t=this.get("canvas"),e=new V({x:0,y:0,parent:t}),n=new V({x:0,y:0,parent:t});t.addLayer(e),t.addLayer(n),this.set("nodeLayer",n),this.set("edgeLayer",e)}},{key:"add",value:function(t,e){var n=this.addItem(t,e);return this.saveData(),n}},{key:"remove",value:function(t){return this.removeItem(t),this.saveData(),t}},{key:"update",value:function(t,e){return this.updateItem(t,e),this.saveData(),t}},{key:"addItem",value:function(t,e){if(e.graph=this,e.zIndex=0,e.type=t,e.cfgKey){var n=this.get("configMap")[e.cfgKey];n?e=m.a.deepMix({},n,e):console.error("配置".concat(e.cfgKey,"不存在"))}if(this.emit("beforeAddItem",e),this.get("stopAdd"))return this.set("stopAdd",!1),!1;var i=e.id||Bt(),r=(e=m.a.mix({},e,{id:i})).parent?this.findById(e.parent):null,o=new Lt[t](e);return r&&r.get("children").unshift(o),this.get(t+"s")&&this.get(t+"s").unshift(o),this.get("itemMap")[i]=o,this.emit("afterAddItem",o),this.autoPaint(),"node"===t&&this.autoExpandDiagram(),o}},{key:"addShape",value:function(t){this.emit("beforeAddShape");var e=t,n=(t.parent||this.get("canvas")).addShape(e),i=this.get("shapeMap"),r=t.id||Bt();return i[r]=n,this.emit("afterAddShape"),this.autoPaint(),r}},{key:"removeItem",value:function(t){var n=this;if(!t)return!1;if(m.a.isString(t)&&(t=this.findById(t)),this.emit("beforeRemoveItem",t),this.get("stopRemove"))return this.set("stopRemove",!1),!1;var e=t.get("id"),i=t.get("type"),r=this.get(i+"s"),o=this.get("shapeMap")[e],a=this.get("itemMap"),s=r.indexOf(t);if(o.parent.remove(o),r.splice(s,1),delete a[e],"node"===i){var u=t.get("outEdges"),c=t.get("inEdges");m.a.each(u,function(t){var e=n.findById(t);n.removeItem(e)}),m.a.each(c,function(t){var e=n.findById(t);n.removeItem(e)})}else if("edge"===i){var l=this.findById(t.get("source")),h=this.findById(t.get("target"));l&&-1<(s=l.get("outEdges").indexOf(e))&&l.get("outEdges").splice(s,1),h&&-1<(s=h.get("inEdges").indexOf(e))&&h.get("inEdges").splice(s,1)}return this.emit("afterRemoveItem",t),this.autoPaint(),t}},{key:"updateItem",value:function(t,e){return!!t&&(this.setAutoPaint(!1),m.a.isString(t)&&(t=this.findById(t)),this.get("gridAlign")&&(e.x||e.y)&&this.gridAlign(e),t.update(e),this.setAutoPaint(!0),t)}},{key:"saveData",value:function(){this.$history.saveState(this.getData())}},{key:"getData",value:function(){var t=this.get("nodes"),e=this.get("edges"),n=m.a.pick(this._cfg,["counter"]);return n.nodes=t.map(function(t){return t.getData()}),n.edges=e.map(function(t){return t.getData()}),n}},{key:"clearData",value:function(){this.$history.clearStates()}},{key:"clear",value:function(){var t=this.get("nodeLayer"),e=this.get("edgeLayer");return t.clear(),e.clear(),this.set({itemMap:{},nodes:[],edges:[],shapeMap:{},eventMap:{},eventItemMap:{},targetMap:{}}),this}},{key:"render",value:function(t){var e=this;this.clear();var n=this.get("autoPaint");this.setAutoPaint(!1),m.a.each(t.nodes,function(t){e.addItem("node",t)}),m.a.each(t.edges,function(t){e.addItem("edge",t)}),this.paint(),this.setAutoPaint(n)}},{key:"destroy",value:function(){window.onkeydown=null}},{key:"paint",value:function(){this.emit("beforePaint"),this.get("canvas").draw(),this.emit("afterPaint")}},{key:"setAutoPaint",value:function(t){this.set("autoPaint",t),this.autoPaint()}},{key:"autoPaint",value:function(){this.get("autoPaint")&&this.paint()}},{key:"getBox",value:function(){var t=this.get("container").getBoundingClientRect();return{l:t.left,t:t.top,r:t.right,b:t.bottom,width:t.width,height:t.height}}},{key:"getPointByClient",value:function(t,e){var n=this.getBox();return this.getPointByCanvas(t-n.l,e-n.t)}},{key:"getPointByCanvas",value:function(t,e){return function(t,e){var n,i,r,o,a,s,u,c,l,h,f,p,g,y,d,v,b,m,x,w,k,_=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,S=(n=[],r=(i=e)[0],o=i[1],a=i[2],s=i[3],u=i[4],c=i[5],l=i[6],h=i[7],f=i[8],(d=r*(p=f*u-c*h)+o*(g=-f*s+c*l)+a*(y=h*s-u*l))?(d=1/d,n[0]=p*d,n[1]=(-f*o+a*h)*d,n[2]=(c*o-a*u)*d,n[3]=g*d,n[4]=(f*r-a*l)*d,n[5]=(-c*r+a*s)*d,n[6]=y*d,n[7]=(-h*r+o*l)*d,n[8]=(u*r-o*s)*d,n):null),P=[t.x,t.y,_];return m=S,x=(b=v=P)[0],w=b[1],k=b[2],v[0]=x*m[0]+w*m[3]+k*m[6],v[1]=x*m[1]+w*m[4]+k*m[7],v[2]=x*m[2]+w*m[5]+k*m[8],{x:P[0],y:P[1]}}({x:t,y:e},this.get("canvas").getMatrix())}},{key:"set",value:function(t,e){m.a.isPlainObject(t)?this._cfg=m.a.mix({},this._cfg,t):this._cfg[t]=e}},{key:"get",value:function(t){return this._cfg[t]}},{key:"setState",value:function(t,e){this.get("state")[t]=e}},{key:"findById",value:function(t){return this.get("itemMap")[t]}},{key:"findShapeById",value:function(t){return this.get("shapeMap")[t]}},{key:"tofront",value:function(t){if(!t)return!1;var e=this.get("".concat(t.get("type"),"s")),n=e.indexOf(t);e.splice(n,1),e.unshift(t);var i=this.get("shapeMap")[t.get("id")],r=i.parent.children;n=r.indexOf(i),r.push(i),this.autoPaint()}},{key:"toback",value:function(t){if(!t)return!1;var e=this.get("".concat(t.get("type"),"s")),n=e.indexOf(t);e.splice(n,1),e.push(t);var i=this.get("shapeMap")[t.get("id")],r=i.parent.children;n=r.indexOf(i),r.unshift(i),this.autoPaint()}},{key:"scale",value:function(t){if(t===this.get("ratio"))return!1;this.get("canvas").scale(t),this.set("ratio",t),this.$scroller.changeSize(),this.autoPaint()}},{key:"translate",value:function(t,e){var n=this.get("canvas");this.set("translateX",t),this.set("translateY",e),n.translate(t,e),this.autoPaint()}},{key:"zoomin",value:function(){var t=this.get("maxRatio"),e=this.get("ratio");e=e+.2<=t?parseFloat((e+.2).toFixed(2)):t,this.scale(e)}},{key:"zoomout",value:function(){var t=this.get("minRatio"),e=this.get("ratio");e=t<=e-.2?parseFloat((e-.2).toFixed(2)):t,this.scale(e)}},{key:"setAutoExpandDiagram",value:function(t){this.set("autoExpandDiagram",t),this.autoExpandDiagram()}},{key:"autoExpandDiagram",value:function(t){this.get("autoExpandDiagram")&&this.expandDiagram(t)}},{key:"expandDiagram",value:function(t){var i=0,r=0,o=0,a=0;if(t)i=t.get("x"),r=t.get("y"),o=i,a=r;else{var e=this.get("nodes");m.a.each(e,function(t){var e=t.get("x"),n=t.get("y");i<e?i=e:e<o&&(o=e),r<n?r=n:n<a&&(a=n)})}var n=this.get("diagramWidth"),s=this.get("diagramHeight"),u=this.get("limitX"),c=this.get("limitY"),l=n-i<u,h=s-r<c;l&&(n+=u),h&&(s+=c),(l||h)&&(this.changeDiagramSize(n,s),this.$scroller.changeSize(),this.autoPaint())}},{key:"changeSize",value:function(t,e){var n=this.get("canvas");this.emit("beforeChangeSize",t,e),this.set("width",t),this.set("height",e),this.$scroller.changeSize(),this.get("enableScroll")&&(this.set("width",t-10),this.set("height",e-10)),n.changeSize(t,e),this.emit("afterChangeSize",t,e),this.autoPaint()}},{key:"gridAlign",value:function(t){var e=t.x||item.get("x"),n=t.y||item.get("y"),i=this.$grid.get("size");return t.x=e-e%i+Math.round(e%i/i)*i,t.y=n-n%i+Math.round(n%i/i)*i,{x:e,y:n}}},{key:"changeDiagramSize",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.emit("beforeChangeDiagramSize",t,e),this._changeDiagramSize(t,e),this._updateBackground(),this.emit("afterChangeDiagramSize",t,e)}},{key:"_changeDiagramSize",value:function(t,e){var n=this._cfg;n.fitcanvas&&(t=t>n.width?t:n.width,e=e>n.height?e:n.height),this.set("diagramWidth",t),this.set("diagramHeight",e)}}])&&ae(e.prototype,i),r&&ae(e,r),n}(),Item:Lt,registerNode:function(t,e){Lt[t]=e(Lt.base)},registerShape:Kt};e.a=le},,function(t,e,n){"use strict";n.r(e);n(8),n(17),n(19);var u=n(2),f=n(0),c=n(3),i=n(5);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var o={};function p(u){var c={},t=function(){var e,t=u.get("nodes");f.a.each(t,function(t){if("start"===t.get("props").key)return e=t,!1});var n=[];return n[0]=[e],function o(t,a,s){f.a.each(t,function(t){var e=u.findById(t).get("target"),n=c[e];if(n){var i=a[n.level].indexOf(n.target);delete a[n.level][i]}var r=u.findById(e);c[e]={level:s,target:r},a[s]?a[s].push(r):a[s]=[r],o(r.get("outEdges"),a,s+1)})}(e.get("outEdges"),n,1),n}();f.a.each(t,function(t,n){f.a.each(t,function(t,e){t&&g(t,120*n+100,120*e+50)})})}var v={rect:{shape:{type:"rect",size:[50,50],style:{stroke:"#00678a",fill:"#eee",lineWidth:2}},stateShapeMap:{default:{type:"rect",size:[50,50],style:{stroke:"#00678a",fill:"#eee",lineWidth:2}},hover:{type:"rect",size:[50,50],style:{stroke:"#00678a",fill:"#000",lineWidth:2}}},props:{key:"start",value:"Start"},anchorMatrix:[[.5,0],[1,.5],[.5,1],[0,.5]],label:"开始",labelCfg:{offsetY:60,style:{color:"#F00",size:"14px"}},event:!0},circle:{shape:{type:"circle",size:25,style:{stroke:"#00678a",fill:"#eee",lineWidth:2}},props:{key:"wait",value:"wait"},anchorMatrix:[[.5,0],[1,.5],[.5,1],[0,.5]],event:!0},diamond:{shape:{type:"diamond",size:[60,60],style:{borderRadius:10,stroke:"#00678a",fill:"#eee",lineWidth:2}},props:{key:"end",value:"end"},anchorMatrix:[[.5,0],[1,.5],[.5,1],[0,.5]],event:!0},edge:{shape:{type:"polyline",style:{stroke:"#edeef4",lineWidth:10}},stateShapeMap:{default:{type:"polyline",style:{stroke:"#edeef4",lineWidth:10}},hover:{style:{stroke:"#CCC"}},focus:{style:{stroke:"#CCC"}}},label:"Label",event:!0,arrow:!0},anchor:{shape:{size:5,style:{lineWidth:2,stroke:"#00678a",fill:"#FFF"}},stateShapeMap:{default:{size:5,style:{lineWidth:2,stroke:"#00678a",fill:"#FFF",transition:{property:["size"],duration:300}}},hover:{size:10,style:{lineWidth:2,stroke:"#CCC",fill:"#FFB2B2",transition:{property:["size"],duration:300}}}},arrow:!0,eventWhenHidden:!0,alwaysShow:!1,eventArea:{r:10},event:!0},outline:{shape:{type:"rect",size:[60,60],style:{borderRadius:5,stroke:"#333",lineDash:[8,8]}},hidden:!0,alwaysShow:!1}};function g(e,t,n){var i=e.get("graph");i.setAutoPaint(!1),i.updateItem(e,{x:t,y:n}),f.a.each(e.get("children"),function(t){"anchor"===t.get("type")?t.updatePosition(e.getAnchorPoint(t.get("m"))):t.updatePosition(e.get("box"))}),i.setAutoPaint(!0)}function y(l){if(!l)return!1;var h=l.get("graph"),e=h.get("container");l.on("stateChange",function(t,e,n){var i=this.get("children");"hover"!==t||n.focus||f.a.each(i,function(t){t.get("alwaysShow")||(e?t.show():t.hide())}),"focus"===t&&f.a.each(i,function(t){t.get("alwaysShow")||(e?t.show():t.hide())})}),l.on("mouseenter",function(t){e.css("cursor","move")}),l.on("mousemove",function(t){}),l.on("mouseleave",function(t){e.css("cursor","auto")}),l.on("mousedown",function(t){}),l.on("click",function(t){}),l.on("mouseup",function(t){});var o={x:0,y:0},a={x:0,y:0};l.on("dragstart",function(t){var e=l;o.x=e._cfg.x,o.y=e._cfg.y,a={x:t.clientX,y:t.clientY}}),l.on("drag",function(t){var e=t.clientX,n=t.clientY,i=a.x,r=a.y;g(l,o.x+(e-i),o.y+(n-r))}),l.on("dragend",function(t){}),l.on("drop",function(t){if(!t.target||"edge"!==t.target.get("type"))return h.expandDiagram(l),h.saveData(),!1;var e=t.target,n={x:t.clientX,y:t.clientY},i=e.getPathPart(n),r=e.getMidPoint(i),o=e.get("endAnchor"),a=e.getLineDirection(i);h.setAutoPaint(!1),l.update(r),f.a.each(l.get("children"),function(t){"anchor"===t.get("type")?t.updatePosition(l.getAnchorPoint(t.get("m"))):t.updatePosition(l.get("box"))});var s=e.get("target");e.set("target",l.get("id")),e.set("endAnchor","V"===a?[.5,0]:[0,.5]);var u=h.findById(s),c=h.addItem("edge",{cfgKey:"edge",source:l.get("id"),target:s,startAnchor:"V"===a?[.5,1]:[1,.5],endAnchor:o,arrow:!0});u.removeEdge("in",e.get("id")),u.addEdge("in",c.get("id")),l.addEdge("in",e.get("id")),l.addEdge("out",c.get("id")),e.updatePath(),h.setAutoPaint(!0)})}i.a.registerNode("outline",function(o){return function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,l(e).apply(this,arguments))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,o),n=e,(i=[{key:"_getShapeCfg",value:function(){var t=this.get("state"),n=this.get("stateShapeMap"),i=this.get("shape");return i.x=this._cfg.x,i.y=this._cfg.y,(i=f.a.mix(i,n.default)).points=this.getPoints(),f.a.each(t,function(t,e){t&&f.a.mix(i,n[e])}),i.hidden=this.get("hidden"),i}},{key:"getPoints",value:function(){var t=this.get("graph"),e=this.get("parent"),n=t.findById(e).get("box");return[{x:n.l-10,y:n.t-10},{x:n.r+10,y:n.t-10},{x:n.r+10,y:n.b+10},{x:n.l-10,y:n.b+10},{x:n.l-10,y:n.t-10}]}},{key:"getDefaultCfg",value:function(){return{state:{},stateShapeMap:{},hidden:!1,shape:{type:"line",style:{stroke:"#333",lineWidth:3,lineDash:[8,8],points:[]}}}}},{key:"updatePosition",value:function(){this.getShape().update({points:this.getPoints()})}}])&&a(n.prototype,i),r&&a(n,r),e}()});var d={list:[{cfgKey:"rect",key:"start",text:"开始",value:"start",iconText:"&#xe6ec;"},{cfgKey:"circle",key:"wait",text:"等待",value:"wait",iconText:"&#xe644;"},{cfgKey:"diamond",key:"end",text:"结束",value:"end",iconText:"&#xe69d;"}],map:{}};f.a.each(d.list,function(t){d.map[t.key]=t});var b=i.a,m=function(g){var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a={list:[],maps:{}},n=Object(u.a)({tag:"div",ref:"sidebar",props:{className:"kgraph-sidebar-container"}},y),i=function(t,e){var n=Object(u.a)({tag:"div",props:{className:"sidebar-section-item item-"+e.key},children:[{tag:"i",ref:"icontext",props:{className:"iconfont",innerHTML:e.iconText}},{tag:"span",props:{innerText:e.text}}]},y);t.append(n),e.width=140,e.height=40,e.icon=y.icontext.text(),e.text=e.text;var i,r,o=(i=e,(r=function(t,e){this.isEdited=i.isEdited,Node.apply(this,[t,e])}).prototype=Object.create(Node.prototype),Object.assign(r.prototype,i),r.prototype.constructor=r);a.list.push(o),a.maps[e.key]=o,s(e,n)},s=function(a,t){var s,u={},c=!1,l=!1,h=[],f=1,p={},o=function(t){var e=t.clientX,n=t.clientY;if(t.pageX,t.pageY,!c){if(!(10<Math.abs(u.x-e)||10<Math.abs(u.y-n)))return!1;c=!0,s=d(a,p.x,p.y),y.container.css("cursor","move")}var i=(l=e>h.l&&e<h.r&&n>h.t&&n<h.b)?f:1;l&&g.handleEvent({type:"mousemove",clientX:e,clientY:n,origin:t});var r=e-u.x,o=n-u.y;s.css({transform:"translate("+r+"px, "+o+"px) scale("+i+")"})},e=function t(e){if(l){var n=g.getPointByClient(e.clientX,e.clientY),i=g.addItem("node",{cfgKey:a.cfgKey,x:n.x,y:n.y,label:a.text}),r=g.get("targetMap").mouseenter;r&&i.emit("drop",{origin:e,clientX:n.x,clientY:n.y,target:r}),g.saveData()}y.container.css("cursor","auto"),s&&(s.remove(),s=null),c=!1,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t)};t.on("mousedown",function(t){1===t.which&&(u.x=t.clientX,u.y=t.clientY,p.x=t.pageX,p.y=t.pageY,h=g.get("canvas").getBox(),f=g.get("ratio"),document.addEventListener("mousemove",o),document.addEventListener("mouseup",e))})},d=function(t,e,n){var i=0,r=0,o=v[t.cfgKey].shape;"circle"===o.type?(i=2*o.size,r=2*o.size):"rect"!==o.type&&"diamond"!==o.type||(i=o.size[0],r=o.size[1]);var a=Object(u.a)({tag:"div",style:{width:i+"px",height:r+"px",border:"1px dashed #333",position:"absolute",left:e-i/2+"px",top:n-r/2+"px",zIndex:999,transform:"translate(0, 0)"}});return Object(c.a)("body").append(a),a};return Object(u.a)({tag:"i",props:{className:"button-open-sidebar iconfont icon-fenlei1"},ref:"buttonOpenSlidebar",evts:{click:function(){n.removeClass("collapse"),setTimeout(function(){g.resize()},200)}}},y),n.append(y.buttonOpenSlidebar),{createSection:function(t,e){Object(u.a)({tag:"div",props:{className:"sidebar-section"},ref:"sidebarSection",children:[{tag:"div",props:{className:"sidebar-section-title"},children:[{tag:"i",props:{className:"iconfont icon-fenlei1"},evts:{click:function(){n.addClass("collapse"),setTimeout(function(){g.resize()},200)}}},{tag:"span",props:{innerText:t}}]},{tag:"div",ref:"seciontItems",props:{className:"sidebar-section-items"}}]},y),e.forEach(function(t){i(y.seciontItems,t)}),n.append(y.sidebarSection)}}},x=[{key:"undo",title:"撤销"},{key:"redo",title:"重做"},{key:"cutOff"},{key:"copy",title:"复制"},{key:"paste",title:"粘贴"},{key:"delete",title:"删除"},{key:"cutOff"},{key:"zoomin",title:"放大"},{key:"zoomout",title:"缩小"},{key:"cutOff"},{key:"fitpagewidth",title:"适应画布"},{key:"fitpage",title:"实际尺寸"},{key:"cutOff"},{key:"tofront",title:"前置"},{key:"toback",title:"后置"}],w=function(o){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=(Object(u.a)({tag:"div",ref:"toolbar",props:{className:"kgraph-toolbar-container"}},a),{list:[],maps:{}}),t=function(){var t=$state.getStateId(),e=$state.getLength();s.maps.undo.config.disabled=0===t,s.maps.redo.config.disabled=e-1<=t},e=function(){var t=!o.getSelectedNode();s.maps.copy.config.disabled=t,s.maps.paste.config.disabled=t,s.maps.delete.config.disabled=t,s.maps.tofront.config.disabled=t,s.maps.toback.config.disabled=t},n=function(){s.list.forEach(function(t){return t.dom[t.config.disabled?"addClass":"removeClass"]("disabled")})};return Object(u.a)({tag:"div",ref:"tools",props:{className:"kgraph-toolbar"}},a),x.forEach(function(t){var e,n,i,r;"cutOff"===t.key?(r=Object(u.a)({tag:"div",props:{className:"cut-off"}}),a.tools.append(r)):!t.hidden&&(e=t,n=Object(u.a)({tag:"div",props:{title:e.title,className:"iconfont icon-"+e.key+" disabled"},evts:{click:function(){o.$trigger(e.key,function(t){"paste"===e.key&&y(t)})}}}),i={name:e.key,config:e,dom:n},s.maps[e.key]=i,s.list.push(i),a.tools.append(n))}),a.toolbar.append(a.tools),{updateTools:function(){t(),e(),n()}}},k=function(t){var e=f.a.mix({a:1,b:2},{c:3,d:4});e.a=11,e.c=13,t.configMap=v;var s=new b.Graph(t,"Root");return console.log(s),s.setAutoPaint(!0),s.on("beforeAddItem",function(t){"edge"===t.type&&(t.id||(t.id="flow"+Date.now()))}),s.on("afterAddItem",function(a){if("edge"===a.get("type"))r=(e=a).get("graph").get("container"),e.on("mouseenter",function(t){var e={x:t.clientX,y:t.clientY},n=this.getPathPart(e),i=this.getLineDirection(n);"V"===i?r.css("cursor","col-resize"):"H"===i?r.css("cursor","row-resize"):r.css("cursor","col-resize")}),e.on("mouseleave",function(t){r.css("cursor","auto")});else if("node"===a.get("type")){var t=a.get("box");s.addItem("base",{cfgKey:"outline",x:t.x,y:t.y,parent:a.get("id")}),s.addItem("base",{x:t.x,y:t.y,parent:a.get("id"),shape:{type:"circle",size:20,style:{stroke:"#F00"}},event:!1}),f.a.each(a.get("anchorMatrix"),function(t){var n,e,i,r=a.getAnchorPoint(t),o=s.addItem("anchor",{cfgKey:"anchor",m:t,parent:a.get("id"),hidden:!0,x:r.x,y:r.y});e=(n=o).get("graph").get("container"),i={mousedown:function(t){},mouseenter:function(t){console.log("anchor mouseenter",t),e.css("cursor","auto")},mouseleave:function(t){t.target&&"node"===t.target.get("type")&&e.css("cursor","move")},dragstart:function(t){console.log("anchor dragstart",t);var e=this.get("graph"),n=t.clientX,i=t.clientY,r=e.addItem("edge",{cfgKey:"edge",source:this.get("parent"),target:null,startAnchor:this.get("m"),endPoint:{x:n,y:i},shape:{parent:e.get("canvas")},arrow:!0});e.set("activeEdge",r)},dragend:function(t){console.log("anchor dragend",t)},drag:function(t){console.log("anchor drag",t,this);var e=this.get("graph").get("activeEdge"),n=t.clientX,i=t.clientY;e.update({endPoint:{x:n,y:i}})},drop:function(t){var e=this.get("graph"),n=e.get("activeEdge");if(t.target&&"anchor"===t.target.get("type")){var i=e.findById(n.get("source")),r=t.target,o=r.get("parent"),a=e.findById(o);n.set("target",o),n.set("endAnchor",r.get("m"));var s=n.get("id");i.addEdge("out",s),a.addEdge("in",s),n.set("arrow",!0),n.updatePath(),this.setState("visited",!0),r.setState("visited",!0);var u=e.findShapeById(s);u.parent.remove(u),e.get("edgeLayer").add(u),e.saveData()}else e.removeItem(n);e.set("activeEdge",null)},dragenter:function(t){console.log("anchor dragenter",t);var e=t.target,n=this.get("graph").get("activeEdge");n&&(n.set("target",e.get("parent")),n.set("endAnchor",e.get("m"))),this.update()},dragleave:function(t){console.log("anchor dragleave",t,this);var e=this.get("graph").get("activeEdge");e&&(e.set("target",null),e.set("endAnchor",null)),this.update()},mouseup:function(t){console.log("anchor mouseup",t,this)}},f.a.each(i,function(t,e){n.on(e,t)})}),y(a)}var e,r}),s.on("beforeChangeSize",function(){}),s.on("copy",function(){console.log(s.get("copiedItem"))}),document.getElementById("save").onclick=function(){var t=s.getData();console.log(JSON.stringify(t))},s};window.onload=function(){var t=Object(c.a)("#kgraph-container-test");o.container=t;var e=Object(u.a)({tag:"div",props:{className:"kgraph-diagram-container"},children:[{tag:"div",props:{className:"kgraph-diagram"},children:[{tag:"canvas",ref:"canvas",props:{id:"kgraph-canvas"}}]}]},o);t.append(e);var n=k({container:"kgraph-diagram",canvasId:"kgraph-canvas",width:window.innerWidth-210,height:400,enableGrid:!0,originRatio:2});n.on("click",function(t){console.log("graph click",t)}),n.on("focus",function(t){console.log("graph focus",t)}),n.on("blur",function(t){console.log("graph blur",t)});n.render({nodes:[{id:"4184744bfe800b37",x:591,y:228,state:{hover:!1},outEdges:[],inEdges:["flow1562666092454"],props:{key:"end",value:"end"},label:"结束",cfgKey:"diamond"},{id:"dfd48ea9c0697bd8",x:452,y:146,state:{hover:!1},outEdges:["flow1562666092454"],inEdges:["flow1562666091039"],props:{key:"wait",value:"wait"},label:"等待",cfgKey:"circle"},{id:"a7d4ad286aa7995a",x:202,y:212,state:{hover:!1},outEdges:["flow1562666091039"],inEdges:[],props:{key:"start",value:"Start"},label:"开始",cfgKey:"rect"}],edges:[{id:"flow1562666092454",state:{hover:!1},source:"dfd48ea9c0697bd8",startAnchor:[1,.5],target:"4184744bfe800b37",endAnchor:[0,.5],props:{},label:"Label",cfgKey:"edge"},{id:"flow1562666091039",state:{},source:"a7d4ad286aa7995a",startAnchor:[1,.5],target:"dfd48ea9c0697bd8",endAnchor:[0,.5],props:{},label:"Label",cfgKey:"edge"}]}),n.saveData(),window.onkeydown=function(t){(window.event.metaKey||window.event.ctrlKey&&window.event.shiftKey)&&75===t.keyCode&&p(n)};var i=new m(n,o);new w(n,o);t.append(o.sidebar),t.append(o.toolbar),i.createSection("基础流程节点",d.list),t.on("mousedown",function(t){t.preventDefault()}),t.on("mousemove",function(t){t.preventDefault()}),t.on("contextmenu",function(t){t.preventDefault()})}},function(t,e){},,,,,,,,,function(t,e){},,function(t,e){}]);